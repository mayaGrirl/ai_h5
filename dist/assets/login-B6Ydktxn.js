import{d as z,o as K,r as n,q as S,n as t,f as U,k as C,C as T,u as w,M as q,x as i,y as a,S as D,V as O,U as P,p as I,E as G,l as v,N as V,D as Y,c as F,L as H}from"./vue-vendor-2ZNhN7Rr.js";import{_ as J}from"./login-logo-DOFsqlSQ.js";import{a as Q,u as W,b as X,t as p,d as Z}from"./index-CL3zLPQY.js";import{h as ee}from"./common-C0Vzt5Ew.js";import{E as te,a as oe,S as se}from"./sodium-BoWtdtrh.js";import"./utils-vendor-CbLx3nH2.js";const ae={class:"flex min-h-screen justify-center bg-[#eef3f8]"},le={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},re={class:"px-3 pb-20 pt-3"},ne={class:"flex bg-white rounded-full shadow-sm overflow-hidden mt-4"},ie={class:"bg-white rounded-xl shadow-sm p-2 border border-gray-100"},ue={class:"flex justify-center items-center border-b border-gray-200"},ce={class:"w-1/4 text-gray-700"},de=["placeholder","value"],me={key:0,class:"flex justify-center items-center"},fe={class:"w-1/4 text-gray-700"},ve={class:"relative w-3/4"},pe=["type","placeholder"],ge={key:1,class:"flex justify-center items-center"},ye={class:"w-1/4 text-gray-700"},he={class:"flex w-3/4 items-center gap-2 flex-wrap sm:flex-nowrap"},be=["placeholder"],we=["disabled"],_e=["disabled"],y="sms_countdown_end_at_login",Me=z({__name:"login",setup(xe){const N=H(),L=Y(),{t:o}=Q(),j=W(),A=F(()=>N.query.redirect||"/"),l=n(1),u=n(""),g=n(""),h=n(""),b=n(!1),c=n(!1),d=n(!1),r=n(0),E=n(""),_=n(!0);let x=null;K(()=>{const s=Number(localStorage.getItem(y));if(s){const e=Math.floor((s-Date.now())/1e3);e>0?(r.value=e,k()):localStorage.removeItem(y)}ee().then(({data:e,code:m})=>{m===200&&(E.value=e.key)})});const k=()=>{if(x&&clearTimeout(x),r.value<=0){localStorage.removeItem(y);return}x=setTimeout(()=>{r.value--,r.value<=0?localStorage.removeItem(y):k()},1e3)},B=async()=>{if(!(!u.value||d.value||r.value>0)){d.value=!0;try{const s=await X(u.value);if(s.code===200){r.value=60;const m=Date.now()+60*1e3;localStorage.setItem(y,String(m)),k(),p.success(s.message||"发送成功")}else p.error(s.message||o("common.sms-verify_code-send-failed"))}catch{p.error(o("common.sms-verify_code-send-failed"))}finally{d.value=!1}}},R=async()=>{if(!(!u.value||c.value)&&!(l.value===1&&!g.value)&&!(l.value===2&&!h.value)){c.value=!0;try{let s="";l.value===1&&g.value&&(s=await se.encrypt(g.value,E.value));const e=await Z({mobile:u.value,password:s||void 0,code:l.value===2?h.value:void 0,type:l.value});e.code===200&&e.data?.access_token?(p.success(e.message||"登录成功"),j.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await j.fetchCurrentCustomer(),L.replace(A.value)):p.error(e.message||o("common.catch-error"))}catch{p.error(o("common.catch-error"))}finally{c.value=!1}}},M=s=>{l.value=s},$=s=>{const e=s.target;u.value=e.value,_.value=e.value.length===0};return(s,e)=>{const m=G("router-link");return v(),S("div",ae,[t("div",le,[t("main",re,[e[5]||(e[5]=t("div",{class:"pt-13 flex items-center justify-center"},[t("img",{src:J,alt:"Login",class:"w-32 h-auto"})],-1)),t("div",ne,[t("button",{type:"button",onClick:e[0]||(e[0]=f=>M(1)),class:w(["flex-1 py-2 text-sm font-medium transition cursor-pointer",l.value===1?"bg-[#ff1020] text-white":"text-gray-500"])}," 密码登录 ",2),t("button",{type:"button",onClick:e[1]||(e[1]=f=>M(2)),class:w(["flex-1 py-2 text-sm font-medium transition cursor-pointer",l.value===2?"bg-[#ff1020] text-white":"text-gray-500"])}," 短信登录 ",2)]),t("form",{onSubmit:q(R,["prevent"]),class:"mt-5"},[t("div",ie,[t("div",ue,[t("label",ce,i(a(o)("register.mobile-label")),1),t("input",{type:"text",placeholder:a(o)("register.mobile-placeholder"),value:u.value,onInput:$,class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,40,de)]),l.value===1?(v(),S("div",me,[t("label",fe,i(a(o)("register.password-label")),1),t("div",ve,[D(t("input",{type:b.value?"text":"password","onUpdate:modelValue":e[2]||(e[2]=f=>g.value=f),placeholder:a(o)("register.password-placeholder"),class:"text-gray-800 placeholder-gray-400 focus:outline-none h-12 w-full pr-10"},null,8,pe),[[O,g.value]]),t("button",{type:"button",tabindex:"-1",onClick:e[3]||(e[3]=f=>b.value=!b.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[b.value?(v(),C(a(te),{key:0,size:18})):(v(),C(a(oe),{key:1,size:18}))])])])):T("",!0),l.value===2?(v(),S("div",ge,[t("label",ye,i(a(o)("common.sms-verify_code-label")),1),t("div",he,[D(t("input",{type:"text",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",placeholder:a(o)("common.sms-verify_code-placeholder"),"onUpdate:modelValue":e[4]||(e[4]=f=>h.value=f),class:"flex-1 min-w-0 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,be),[[P,h.value]]),t("button",{type:"button",disabled:r.value>0||d.value||_.value,onClick:B,class:w(["shrink-0 h-8 px-3 rounded text-xs whitespace-nowrap transition",r.value>0||d.value||_.value?"bg-gray-600 text-white cursor-not-allowed":"bg-blue-600 text-white active:scale-95 cursor-pointer"])},i(d.value?a(o)("common.sms-verify_code-sending"):r.value>0?`${r.value}s`:a(o)("common.sms-verify_code-send-btn")),11,we)])])):T("",!0)]),t("button",{type:"submit",disabled:c.value,class:w(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",c.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},i(c.value?a(o)("common.form.button.submitting"):a(o)("login.submit-btn")),11,_e)],32),U(m,{to:"/auth/register",class:"mt-3 h-12 w-full flex items-center justify-center rounded-full bg-[#0d6efd] text-white font-medium tracking-wide transition transform active:scale-95"},{default:I(()=>[V(i(a(o)("login.register-btn")),1)]),_:1}),l.value===1?(v(),C(m,{key:0,to:"/auth/forgot-password",class:"flex justify-center items-center mt-6 text-[rgb(0,0,238)]"},{default:I(()=>[V(i(a(o)("login.forgot-password-btn")),1)]),_:1})):T("",!0)])])])}}});export{Me as default};
