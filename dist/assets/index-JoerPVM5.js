import{_ as q}from"./coin-BjeO1Yvx.js";import{d as F,w as N,o as P,I as E,B as J,c as G,q as a,f as O,l as s,u as d,F as h,t as k,J as m,L as w,z as l,r as i,x as B,v as o}from"./vue-vendor-ntQnFNWs.js";import{a as Q,t as g}from"./index-C6XK1gma.js";import{s as U,r as W,i as X,j as ee}from"./customer-BXjt1XCl.js";import{g as te}from"./common-v3aAoxrt.js";import{_ as se}from"./PageHeader.vue_vue_type_script_setup_true_lang-CEmtFThu.js";import{d as A}from"./dayjs.min-CLb2-34J.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-CXUrgsmq.js";const re={class:"min-h-screen bg-[#f5f7fb] pb-16"},ae={class:"grid grid-cols-3 text-center text-sm bg-white"},oe=["onClick"],le={class:"p-2"},ne={key:0,class:"px-4 py-4 bg-white rounded-lg"},ie={class:"flex items-center mb-2"},ce=["innerHTML"],de={key:1},ue={key:0,class:"grid px-3 mb-2"},ve=["disabled"],ye={class:"bg-white rounded-lg"},fe={key:0,class:"flex justify-center items-center py-8"},me={key:1,class:"text-center py-8 text-gray-500"},ge={key:2},_e={class:"leading-tight"},pe={class:"text-gray-500"},xe={class:"mt-0.5"},be={class:"text-red-500 font-semibold ml-1"},he={class:"flex justify-end items-center gap-1 font-medium"},ke=["onClick"],we={key:1,class:"text-right text-xs text-gray-500"},Ce={key:0,class:"py-4 text-center"},De=["disabled"],Le={key:1,class:"py-4 text-center text-gray-400 text-sm"},Me={key:2,class:"bg-white rounded-lg"},Re={class:"grid grid-cols-[0.3fr_0.8fr_0.5fr_0.8fr] px-3 py-2 text-xs text-gray-500 border-b"},Ye={class:"text-center"},qe={class:"text-center"},Be={class:"text-right"},Se={key:0,class:"flex justify-center items-center py-8"},je={key:1,class:"text-center py-8 text-gray-500"},He={key:2},$e={class:"leading-tight"},ze={class:"text-center font-medium"},Ae={class:"text-center font-medium text-red-500"},Ie={class:"flex justify-end items-center gap-1 font-medium"},Ke={key:0,class:"py-4 text-center"},Ve=["disabled"],Te={key:1,class:"py-4 text-center text-gray-400 text-sm"},et=F({__name:"index",setup(Ze){const C=E(),S=J(),{t:c}=Q(),v=G(()=>C.query.tab||"intro"),I=[{key:"intro",i18Key:"mine.salary.tab-1"},{key:"receive",i18Key:"mine.salary.tab-2"},{key:"record",i18Key:"mine.salary.tab-3"}],K=t=>{S.replace({query:{tab:t}})},j=i(""),D=i(!1),H=async()=>{D.value=!0;try{const t=await te("customer_salary_intro_tips");t.code===200&&t.data&&(j.value=t.data.content||"")}catch(t){console.error("加载工资说明失败",t)}finally{D.value=!1}},u=i([]),$=i(1),L=i(!0),_=i(!1),p=i(new Set),f=i(!1),b=async(t=1,r=!1)=>{_.value=!0;try{const e=await U({page:t,pageSize:20});if(e.code===200&&e.data){const n=e.data||[];r?u.value=n:u.value=[...u.value,...n],L.value=n.length>=20,$.value=t}}catch(e){console.error("加载工资领取列表失败",e)}finally{_.value=!1}},V=async t=>{if(!p.value.has(t)){p.value.add(t);try{const r=await ee(t);r.code===200?(g.success(r.message||"领取成功"),u.value=u.value.map(e=>e.id===t?r.data:e)):g.error(r.message||"领取失败")}catch{g.error("领取失败")}finally{p.value.delete(t)}}},T=async()=>{if(!f.value){f.value=!0;try{const t=await W();t.code===200?(g.success(t.message||"领取成功"),await b(1,!0)):g.error(t.message||"领取失败")}catch{g.error("领取失败")}finally{f.value=!1}}},y=i([]),z=i(1),M=i(!0),x=i(!1),R=async(t=1,r=!1)=>{x.value=!0;try{const e=await X({page:t,pageSize:20});if(e.code===200&&e.data){const n=e.data||[];r?y.value=n:y.value=[...y.value,...n],M.value=n.length>=20,z.value=t}}catch(e){console.error("加载工资记录失败",e)}finally{x.value=!1}};N(()=>C.query.tab,t=>{t==="intro"||!t?H():t==="receive"?b(1,!0):t==="record"&&R(1,!0)});const Y=t=>t?A.unix(t).format("YYYY-MM-DD"):"",Z=t=>t?A.unix(t).format("YYYY-MM-DD HH:mm"):"";return P(()=>{C.query.tab||S.replace({query:{tab:"intro"}}),v.value==="intro"?H():v.value==="receive"?b(1,!0):v.value==="record"&&R(1,!0)}),(t,r)=>(o(),a("div",re,[O(se,{title:d(c)("mine.quick.salary")},null,8,["title"]),s("div",ae,[(o(),a(h,null,k(I,e=>s("button",{key:e.key,onClick:n=>K(e.key),class:B(["py-3 text-center transition-colors",v.value===e.key?"text-red-500 font-bold border-b-2 border-red-500":"text-gray-500 hover:text-gray-700"])},l(d(c)(e.i18Key)),11,oe)),64))]),s("div",le,[v.value==="intro"?(o(),a("div",ne,[s("div",ie,[w(l(d(c)("mine.salary.intro-accumulated-salary"))+" ",1),r[2]||(r[2]=s("span",{class:"text-red-500 font-semibold ml-1"},"0",-1)),r[3]||(r[3]=s("img",{src:q,alt:"coin",class:"inline-block w-[13px] h-[13px]"},null,-1))]),D.value?(o(),a(h,{key:0},k(12,e=>s("div",{key:e,class:"h-4 bg-gray-200 rounded animate-pulse mb-2"})),64)):(o(),a("div",{key:1,class:"prose prose-sm max-w-none text-gray-700",innerHTML:j.value},null,8,ce))])):v.value==="receive"?(o(),a("div",de,[u.value.length>0?(o(),a("div",ue,[s("button",{onClick:T,disabled:f.value,class:B(["h-9 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium transition active:scale-95",f.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},l(f.value?d(c)("common.form.button.submitting"):d(c)("mine.salary.receive-all-btn")),11,ve)])):m("",!0),s("div",ye,[_.value&&u.value.length===0?(o(),a("div",fe,[...r[4]||(r[4]=[s("div",{class:"inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"},null,-1),s("span",{class:"ml-2 text-gray-600"},"加载中...",-1)])])):u.value.length===0?(o(),a("div",me," 暂无数据 ")):(o(),a("div",ge,[(o(!0),a(h,null,k(u.value,(e,n)=>(o(),a("div",{key:n,class:"grid grid-cols-[1.2fr_0.8fr] px-3 py-3 border-b text-sm items-center"},[s("div",_e,[s("div",pe,l(Y(e.ctdateA))+" - "+l(Y(e.ctdateB)),1),s("div",xe,[r[5]||(r[5]=w(" 工资金额：",-1)),s("span",be,l(e.coin),1),r[6]||(r[6]=s("img",{src:q,alt:"coin",class:"inline-block w-[13px] h-[13px]"},null,-1))])]),s("div",he,[e.status===0?(o(),a("button",{key:0,onClick:Fe=>V(e.id||0),class:B(["px-2 py-1 text-xs rounded",p.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer"])},l(p.value.has(e.id||0)?d(c)("common.form.button.submitting"):d(c)("mine.salary.receive-grid-btn")),11,ke)):(o(),a("div",we,[w(l(e.status_label)+" ",1),s("div",null,"("+l(Z(e.gettime))+")",1)]))])]))),128)),L.value?(o(),a("div",Ce,[s("button",{onClick:r[0]||(r[0]=e=>b($.value+1,!1)),disabled:_.value,class:"px-6 py-2 bg-red-600 text-white text-sm rounded-lg disabled:opacity-50"},l(_.value?"加载中...":"加载更多"),9,De)])):m("",!0),!L.value&&u.value.length>0?(o(),a("div",Le," 没有更多数据了 ")):m("",!0)]))])])):v.value==="record"?(o(),a("div",Me,[s("div",Re,[s("div",null,l(d(c)("mine.salary.record-grid-1")),1),s("div",Ye,l(d(c)("mine.salary.record-grid-2")),1),s("div",qe,l(d(c)("mine.salary.record-grid-3")),1),s("div",Be,l(d(c)("mine.salary.record-grid-4")),1)]),x.value&&y.value.length===0?(o(),a("div",Se,[...r[7]||(r[7]=[s("div",{class:"inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"},null,-1),s("span",{class:"ml-2 text-gray-600"},"加载中...",-1)])])):y.value.length===0?(o(),a("div",je," 暂无数据 ")):(o(),a("div",He,[(o(!0),a(h,null,k(y.value,(e,n)=>(o(),a("div",{key:n,class:"grid grid-cols-[0.3fr_0.8fr_0.5fr_0.8fr] px-3 py-3 border-b text-sm items-center"},[s("div",$e,l(e.typestr),1),s("div",ze,l(e.basecoin),1),s("div",Ae,[w(l(e.coin)+" ",1),r[8]||(r[8]=s("img",{src:q,alt:"coin",class:"inline-block w-[13px] h-[13px]"},null,-1))]),s("div",Ie,l(Y(e.addtime)),1)]))),128)),M.value?(o(),a("div",Ke,[s("button",{onClick:r[1]||(r[1]=e=>R(z.value+1,!1)),disabled:x.value,class:"px-6 py-2 bg-red-600 text-white text-sm rounded-lg disabled:opacity-50"},l(x.value?"加载中...":"加载更多"),9,Ve)])):m("",!0),!M.value&&y.value.length>0?(o(),a("div",Te," 没有更多数据了 ")):m("",!0)]))])):m("",!0)])]))}});export{et as default};
