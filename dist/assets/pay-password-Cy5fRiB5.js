import{d as N,o as P,r as p,q as u,l as e,f as T,u as a,K as U,J as f,L as _,z as n,Q as y,S as b,k as w,U as q,F as k,t as S,R as j,x as D,B as I,v as i}from"./vue-vendor-ntQnFNWs.js";import{a as K,S as L,t as g}from"./index-CFMypmBh.js";import{f as O}from"./customer-Dq31nYw8.js";import{g as F,h as R}from"./common-BYJOfID-.js";import{E as C,a as V,S as B}from"./sodium-Camv0W1V.js";import{_ as $}from"./PageHeader.vue_vue_type_script_setup_true_lang-CAbp2TtD.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-Cq0BIQK6.js";const H={class:"flex min-h-screen justify-center bg-[#eef3f8]"},Q={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},A={class:"bg-gray-100 flex justify-center"},J={class:"bg-white rounded-lg mb-3 overflow-hidden"},G={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},W={class:"flex items-center px-4 py-3 border-b"},X={class:"w-2/7 text-gray-700"},Y={class:"w-5/7 relative"},Z=["type","placeholder"],ee={key:0,class:"mt-1 px-4 text-xs text-red-500"},se={class:"flex items-center px-4 py-3"},te={class:"w-2/7 text-gray-700"},ae={class:"w-5/7 relative"},oe=["type","placeholder"],re={key:1,class:"mt-1 px-4 text-xs text-red-500"},le={class:"bg-white rounded-lg mb-3 overflow-hidden"},ne={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},ie={class:"flex items-center px-4 py-3 border-b"},ue={class:"w-2/7 text-gray-700"},de={value:""},ce=["value"],pe={key:0,class:"mt-1 px-4 text-xs text-red-500"},me={class:"flex items-center px-4 py-3"},fe={class:"w-2/7 text-gray-700"},ye=["placeholder"],we={key:1,class:"mt-1 px-4 text-xs text-red-500"},ve={class:"rounded-lg mb-3 overflow-hidden"},_e={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},ge={key:0,class:"px-4 py-3 space-y-2"},xe=["innerHTML"],he=["disabled"],Pe=N({__name:"pay-password",setup(be){const E=I(),{t}=K(),x=p(!0),h=p(""),c=p(!1),m=p(!1),v=p(""),o=p({safe_ask:"",answer:"",password:"",confirm_password:""}),l=p({}),M=()=>(l.value={},o.value.safe_ask?o.value.answer?o.value.answer.length>50?(l.value.answer=t("mine.security-settings.group-account.password.answer-max"),!1):!o.value.password||o.value.password.length<8?(l.value.password=t("mine.security-settings.group-account.pay-password.password-min"),!1):o.value.password!==o.value.confirm_password?(l.value.confirm_password=t("mine.security-settings.group-account.password.confirm-password-eq"),!1):!0:(l.value.answer=t("common.form.placeholder.enter")+t("mine.toolcase.form-label.answer"),!1):(l.value.safe_ask=t("mine.toolcase.question-options.default"),!1)),z=async()=>{if(M()){m.value=!0;try{const d=await B.encrypt(o.value.password,v.value),s=await B.encrypt(o.value.confirm_password,v.value),r=await O({safe_ask:o.value.safe_ask,answer:o.value.answer,password:d,confirm_password:s});r.code===200?(g.success(r.message||"修改成功"),E.back()):g.error(r.message||"修改失败")}catch{g.error("修改失败")}finally{m.value=!1}}};return P(async()=>{try{const d=await F("customer_pay_password_tips");h.value=d.data?.content||""}catch(d){console.error("加载提示内容失败",d)}finally{x.value=!1}R().then(({data:d,code:s})=>{s===200&&(v.value=d.key)})}),(d,s)=>(i(),u("div",H,[e("div",Q,[T($,{title:a(t)("mine.setting.edit-pay-password")},null,8,["title"]),e("div",A,[e("form",{onSubmit:U(z,["prevent"]),class:"w-full bg-gray-100 px-3 py-4"},[e("div",J,[e("div",G,[s[6]||(s[6]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),_(" "+n(a(t)("mine.security-settings.group-account.pay-password.password")),1)]),e("div",W,[e("label",X,n(a(t)("mine.security-settings.group-account.pay-password.password")),1),e("div",Y,[y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.pay-password.password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,Z),[[b,o.value.password]]),e("button",{type:"button",onClick:s[1]||(s[1]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),w(a(C),{key:0,size:18})):(i(),w(a(V),{key:1,size:18}))])])]),l.value.password?(i(),u("p",ee,n(l.value.password),1)):f("",!0),e("div",se,[e("label",te,n(a(t)("mine.security-settings.group-account.pay-password.confirm-password")),1),e("div",ae,[y(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.confirm_password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.pay-password.confirm-password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,oe),[[b,o.value.confirm_password]]),e("button",{type:"button",onClick:s[3]||(s[3]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),w(a(C),{key:0,size:18})):(i(),w(a(V),{key:1,size:18}))])])]),l.value.confirm_password?(i(),u("p",re,n(l.value.confirm_password),1)):f("",!0)]),e("div",le,[e("div",ne,[s[7]||(s[7]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),_(" "+n(a(t)("mine.security-settings.group-account.password.safe-ask-valid")),1)]),e("div",ie,[e("label",ue,n(a(t)("mine.toolcase.form-label.question")),1),y(e("select",{"onUpdate:modelValue":s[4]||(s[4]=r=>o.value.safe_ask=r),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},[e("option",de,n(a(t)("mine.toolcase.question-options.default")),1),(i(!0),u(k,null,S(a(L),r=>(i(),u("option",{key:r.value,value:r.value},n(a(t)(r.i18nKey)),9,ce))),128))],512),[[q,o.value.safe_ask]])]),l.value.safe_ask?(i(),u("p",pe,n(l.value.safe_ask),1)):f("",!0),e("div",me,[e("label",fe,n(a(t)("mine.toolcase.form-label.answer")),1),y(e("input",{"onUpdate:modelValue":s[5]||(s[5]=r=>o.value.answer=r),type:"text",placeholder:a(t)("common.form.placeholder.enter")+a(t)("mine.toolcase.form-label.answer"),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},null,8,ye),[[j,o.value.answer]])]),l.value.answer?(i(),u("p",we,n(l.value.answer),1)):f("",!0)]),e("div",ve,[e("div",_e,[s[8]||(s[8]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),_(" "+n(a(t)("mine.security-settings.group-account.password.tip")),1)]),x.value?(i(),u("div",ge,[(i(),u(k,null,S(3,r=>e("div",{key:r,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(i(),u("div",{key:1,class:"px-4 py-3 text-gray-600",innerHTML:h.value},null,8,xe))]),e("button",{type:"submit",disabled:m.value,class:D(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",m.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},n(m.value?a(t)("common.form.button.submitting"):a(t)("common.form.button.submit")),11,he)],32)]),s[9]||(s[9]=e("div",{class:"h-14"},null,-1))])]))}});export{Pe as default};
