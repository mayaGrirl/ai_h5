import{_ as S}from"./coin-BjeO1Yvx.js";import{s as R,r as j,j as A}from"./customer-D1FIUO_K.js";import{t as r}from"./index-DBwKxXoa.js";import{d as b}from"./dayjs.min-CLb2-34J.js";import{c as B}from"./index-C6jzfBHC.js";import{d as N,o as V,r as u,b as Z,q as o,n as l,C as w,u as k,x as n,F as Y,t as z,l as i,y as p,N as M}from"./vue-vendor-2ZNhN7Rr.js";import"./utils-vendor-CbLx3nH2.js";const F={class:"grid px-3"},H=["disabled"],I={class:"leading-tight"},P={class:"text-gray-500"},T={class:"mt-0.5 text-gray-900"},$={class:"text-red-500 font-semibold ml-1"},q={class:"flex justify-end items-center gap-1 font-medium"},E=["onClick"],L={key:1,class:"grid justify-items-end"},O={key:1,class:"py-4 text-center text-xs text-gray-400"},te=N({__name:"index",setup(U){const s=u([]),x=u(1),v=u(!0),y=u(!1),c=u(new Set),f=u(!1),_=u(null);let g=null;const h=async t=>{y.value=!0;try{const{code:e,data:a,message:d}=await R({pagination:{page:t,size:20}});await new Promise(m=>setTimeout(m,700)),e===200?(a.length<20&&(v.value=!1),t===1&&(s.value=[]),s.value=[...s.value,...a]):r.error(d)}catch{r.error("获取数据失败")}finally{y.value=!1}},D=async t=>{if(!c.value.has(t)){c.value=new Set(c.value).add(t);try{const{code:e,data:a,message:d}=await A(t);e===200?(r.success(d),s.value=s.value.map(m=>m.id===t?a:m)):r.error(d)}catch{r.error("领取失败")}finally{const e=new Set(c.value);e.delete(t),c.value=e}}},C=async()=>{f.value=!0;try{const{code:t,message:e}=await j();t===200?(r.success(e),s.value=[],x.value=1,v.value=!0,await h(1)):r.error(e)}catch{r.error("一键领取失败")}finally{f.value=!1}};return V(async()=>{await h(1),_.value&&v.value&&(g=new IntersectionObserver(([t])=>{if(t.isIntersecting&&!y.value){const e=x.value+1;x.value=e,h(e)}},{threshold:1}),g.observe(_.value))}),Z(()=>{g&&g.disconnect()}),(t,e)=>(i(),o(Y,null,[l("div",F,[s.value.length>0?(i(),o("button",{key:0,onClick:C,disabled:f.value,class:k(["mb-1 h-9 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium transition active:scale-95",f.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},n(f.value?"领取中...":"一键领取"),11,H)):w("",!0)]),(i(!0),o(Y,null,z(s.value,(a,d)=>(i(),o("div",{key:`all-key-${d}`,class:"grid grid-cols-[1.2fr_0.8fr] px-3 py-3 border-b text-sm items-center"},[l("div",I,[l("div",P," 周期: "+n(p(b).unix(a?.ctdateA||0).format("YYYY-MM-DD"))+" 至 "+n(p(b).unix(a?.ctdateB||0).format("YYYY-MM-DD")),1),l("div",T,[e[0]||(e[0]=M(" 可领取工资 ",-1)),l("span",$,n(a.coin),1),e[1]||(e[1]=l("img",{class:"inline-block w-[13px] h-[13px]",src:S,alt:"gold"},null,-1))])]),l("div",q,[a.status===0?(i(),o("button",{key:0,class:k(p(B)("px-2 py-1 text-xs rounded",c.value.has(a.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer")),onClick:m=>D(a.id||0)},n(c.value.has(a.id||0)?"领取中...":"领取"),11,E)):(i(),o("div",L,[M(n(a.status_label)+" ",1),l("div",null,"("+n(p(b).unix(a?.gettime||0).format("YYYY-MM-DD HH:mm"))+")",1)]))])]))),128)),v.value?(i(),o("div",{key:0,ref_key:"loadMoreRef",ref:_,class:"py-4 text-center text-xs text-gray-400"},n(y.value?"加载中...":"上拉加载更多"),513)):w("",!0),v.value?w("",!0):(i(),o("div",O," 没有更多数据了 "))],64))}});export{te as default};
