import{d as T,w as W,o as E,I as J,c as S,B as N,q as o,f as A,l as r,u as l,F as R,t as q,J as x,z as s,r as i,v as n,x as z}from"./vue-vendor-ntQnFNWs.js";import{a as G,t as v}from"./index-DKPP7pX5.js";import{w as O,q as Q,t as U,x as X}from"./customer-BQW5vcIt.js";import{_ as Z}from"./PageHeader.vue_vue_type_script_setup_true_lang-B2tQn8Xc.js";import{d as Y}from"./dayjs.min-CLb2-34J.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-9eMTeFtj.js";const ee={class:"min-h-screen bg-[#f5f7fb] pb-16"},te={class:"grid grid-cols-2 text-center text-sm bg-white"},se=["onClick"],re={class:"p-2"},ae={key:0,class:"bg-white rounded-lg"},oe={class:"grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-2 text-xs text-gray-500 border-b"},ne={class:"text-center"},ce={class:"text-center"},le={class:"text-center"},de={class:"text-center"},ie={class:"text-center"},ue={key:0,class:"flex justify-center items-center py-8"},_e={class:"ml-2 text-gray-600"},ve={key:1,class:"text-center py-8 text-gray-500"},he={key:2},ge={class:"text-center text-xs"},be={class:"text-center font-medium"},fe={class:"text-center font-medium"},ye={class:"text-center font-medium"},xe={class:"text-center font-medium"},me={key:0},pe={key:1},ke=["onClick"],we={key:0,class:"py-4 text-center"},Ce=["disabled"],Le={key:1,class:"py-4 text-center text-gray-400 text-sm"},Se={key:1,class:"bg-white rounded-lg"},Re={class:"grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-2 text-xs text-gray-500 border-b"},qe={class:"text-center"},ze={class:"text-center"},De={class:"text-center"},He={class:"text-center"},$e={class:"text-center"},Be={key:0,class:"flex justify-center items-center py-8"},Me={class:"ml-2 text-gray-600"},Ye={key:1,class:"text-center py-8 text-gray-500"},je={key:2},Ke={class:"text-center text-xs"},Ve={class:"text-center font-medium"},Fe={class:"text-center font-medium"},Ie={class:"text-center font-medium"},Pe={class:"text-center font-medium"},Te={key:0},We={key:1},Ee=["onClick"],Je={key:0,class:"py-4 text-center"},Ne=["disabled"],Ae={key:1,class:"py-4 text-center text-gray-400 text-sm"},rt=T({__name:"index",setup(Ge){const m=J(),D=N(),{t:c}=G(),h=S(()=>m.query.tab||"recharge"),p=S(()=>m.query.from==="drawer"),j=[{key:"recharge",i18Key:"rebate.tab-1"},{key:"loss",i18Key:"rebate.tab-2"}],K=t=>{const a={tab:t};p.value&&(a.from="drawer"),D.replace({query:a})},u=i([]),H=i(1),k=i(!0),g=i(!1),b=i(new Set),w=async(t=1,a=!1)=>{g.value=!0;try{const e=await O({page:t,pageSize:20});if(e.code===200&&e.data){const d=e.data||[];a?u.value=d:u.value=[...u.value,...d],k.value=d.length>=20,H.value=t}}catch(e){console.error("加载充值返利记录失败",e)}finally{g.value=!1}},V=async t=>{if(!b.value.has(t)){b.value.add(t);try{const a=await U(t);a.code===200?(v.success(a.message||"领取成功"),u.value=u.value.map(e=>e.id===t?a.data:e)):v.error(a.message||"领取失败")}catch{v.error("领取失败")}finally{b.value.delete(t)}}},_=i([]),$=i(1),C=i(!0),f=i(!1),y=i(new Set),L=async(t=1,a=!1)=>{f.value=!0;try{const e=await Q({page:t,pageSize:20});if(e.code===200&&e.data){const d=e.data||[];a?_.value=d:_.value=[..._.value,...d],C.value=d.length>=20,$.value=t}}catch(e){console.error("加载亏损返利记录失败",e)}finally{f.value=!1}},F=async t=>{if(!y.value.has(t)){y.value.add(t);try{const a=await X(t);a.code===200?(v.success(a.message||"领取成功"),_.value=_.value.map(e=>e.id===t?a.data:e)):v.error(a.message||"领取失败")}catch{v.error("领取失败")}finally{y.value.delete(t)}}},B=t=>t?Y.unix(t).format("YYYY-MM-DD HH:mm"):"",M=t=>t?Y.unix(t).format("HH:mm"):"",I=S(()=>p.value?"/mine?drawer=setting":void 0);return W(()=>m.query.tab,t=>{t==="recharge"||!t?w(1,!0):t==="loss"&&L(1,!0)}),E(()=>{if(!m.query.tab){const t={tab:"recharge"};p.value&&(t.from="drawer"),D.replace({query:t})}h.value==="recharge"?w(1,!0):h.value==="loss"&&L(1,!0)}),(t,a)=>(n(),o("div",ee,[A(Z,{title:l(c)("rebate.header-title"),"custom-back":I.value},null,8,["title","custom-back"]),r("div",te,[(n(),o(R,null,q(j,e=>r("button",{key:e.key,onClick:d=>K(e.key),class:z(["py-3 text-center transition-colors",h.value===e.key?"text-red-500 font-bold border-b-2 border-red-500":"text-gray-500 hover:text-gray-700"])},s(l(c)(e.i18Key)),11,se)),64))]),r("div",re,[h.value==="recharge"?(n(),o("div",ae,[r("div",oe,[r("div",ne,s(l(c)("rebate.recharge-table-header-1")),1),r("div",ce,s(l(c)("rebate.recharge-table-header-2")),1),r("div",le,s(l(c)("rebate.recharge-table-header-3")),1),r("div",de,s(l(c)("rebate.recharge-table-header-4")),1),r("div",ie,s(l(c)("rebate.recharge-table-header-5")),1)]),g.value&&u.value.length===0?(n(),o("div",ue,[a[2]||(a[2]=r("div",{class:"inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"},null,-1)),r("span",_e,s(l(c)("common.loading")),1)])):u.value.length===0?(n(),o("div",ve," 暂无数据 ")):(n(),o("div",he,[(n(!0),o(R,null,q(u.value,(e,d)=>(n(),o("div",{key:d,class:"grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-3 border-b text-sm items-center"},[r("div",ge,s(B(e?.addtime)),1),r("div",be,s((e?.wpoints||0).toLocaleString()),1),r("div",fe,s(((e?.cz||0)*1e3).toLocaleString()),1),r("div",ye,s((e?.hdpoints||0).toLocaleString()),1),r("div",xe,[e.state===1?(n(),o("div",me,s(e.state_label)+"("+s(M(e?.gettime))+")",1)):e.state===2||e.state===3?(n(),o("div",pe,s(e.state_label),1)):(n(),o("button",{key:2,onClick:P=>V(e.id||0),class:z(["px-2 py-1 text-xs rounded",b.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer"])},s(b.value.has(e.id||0)?l(c)("common.form.button.submitting"):l(c)("rebate.recharge-receive-btn")),11,ke))])]))),128)),k.value?(n(),o("div",we,[r("button",{onClick:a[0]||(a[0]=e=>w(H.value+1,!1)),disabled:g.value,class:"px-6 py-2 bg-red-600 text-white text-sm rounded-lg disabled:opacity-50"},s(g.value?l(c)("common.loading"):"加载更多"),9,Ce)])):x("",!0),!k.value&&u.value.length>0?(n(),o("div",Le,s(l(c)("common.loading-list-empty")),1)):x("",!0)]))])):h.value==="loss"?(n(),o("div",Se,[r("div",Re,[r("div",qe,s(l(c)("rebate.loss-table-header-1")),1),r("div",ze,s(l(c)("rebate.loss-table-header-2")),1),r("div",De,s(l(c)("rebate.loss-table-header-3")),1),r("div",He,s(l(c)("rebate.loss-table-header-4")),1),r("div",$e,s(l(c)("rebate.loss-table-header-5")),1)]),f.value&&_.value.length===0?(n(),o("div",Be,[a[3]||(a[3]=r("div",{class:"inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"},null,-1)),r("span",Me,s(l(c)("common.loading")),1)])):_.value.length===0?(n(),o("div",Ye," 暂无数据 ")):(n(),o("div",je,[(n(!0),o(R,null,q(_.value,(e,d)=>(n(),o("div",{key:d,class:"grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-3 border-b text-sm items-center"},[r("div",Ke,s(B(e?.addtime)),1),r("div",Ve,s((e?.points||0).toLocaleString()),1),r("div",Fe,s(((e?.cz||0)*1e3).toLocaleString()),1),r("div",Ie,s((e?.hdpoints||0).toLocaleString()),1),r("div",Pe,[e.state===1?(n(),o("div",Te,s(e.state_label)+"("+s(M(e?.gettime))+")",1)):e.state===2||e.state===3?(n(),o("div",We,s(e.state_label),1)):(n(),o("button",{key:2,onClick:P=>F(e.id||0),class:z(["px-2 py-1 text-xs rounded",y.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer"])},s(y.value.has(e.id||0)?l(c)("common.form.button.submitting"):l(c)("rebate.recharge-receive-btn")),11,Ee))])]))),128)),C.value?(n(),o("div",Je,[r("button",{onClick:a[1]||(a[1]=e=>L($.value+1,!1)),disabled:f.value,class:"px-6 py-2 bg-red-600 text-white text-sm rounded-lg disabled:opacity-50"},s(f.value?l(c)("common.loading"):"加载更多"),9,Ne)])):x("",!0),!C.value&&_.value.length>0?(n(),o("div",Ae,s(l(c)("common.loading-list-empty")),1)):x("",!0)]))])):x("",!0)])]))}});export{rt as default};
