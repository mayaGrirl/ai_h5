import{d as U,r as m,c as Q,o as R,q as i,n as e,f as p,p as V,E as Y,N as u,x as a,y as s,M as $,C as g,F as T,t as q,u as G,l as r}from"./vue-vendor-2ZNhN7Rr.js";import{_ as C}from"./coin-BjeO1Yvx.js";import{a as J,t as y,S as W}from"./index-BFniYAsS.js";import{u as X,t as Z,o as ee,s as N,n as z}from"./vee-validate-zod-ClGdzsdl.js";import{D as te}from"./utils-vendor-CbLx3nH2.js";import{c as se,_ as oe,a as ae}from"./ReceiveSms.vue_vue_type_script_setup_true_lang-BIjvCyi2.js";import{C as F}from"./chevron-right-ClPEDAMH.js";import"./customer-GqufupLc.js";const ne={class:"flex min-h-screen justify-center bg-[#eef3f8]"},le={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},ie={class:"grid grid-cols-2 gap-2 px-3 pt-3"},re={class:"text-black flex items-center"},ce={class:"text-black flex items-center"},de={class:"w-full bg-gray-100 px-3 py-4"},me={class:"bg-white rounded-lg mb-3 overflow-hidden"},ue={class:"grid grid-cols-2 gap-2 items-center px-3 pt-3 bg-white border-b rounded-lg"},pe={class:"flex items-center gap-1 text-red-500 font-semibold"},fe={class:"text-gray-500"},_e={class:"flex items-center gap-1 text-red-500 font-semibold"},ve={class:"text-gray-500"},xe={class:"grid grid-cols-2 gap-2 items-center px-3 py-3 bg-white rounded-lg"},he={class:"flex items-center gap-1 text-red-500 font-semibold"},ge={class:"text-gray-500"},ye={class:"flex items-center gap-1 text-red-500 font-semibold"},be={class:"text-gray-500"},we={class:"bg-white rounded-lg mb-3 overflow-hidden"},ke={class:"flex items-center px-4 pt-3"},Ce={class:"w-[30%] text-gray-700",for:"amount"},Ne=["placeholder"],Se={key:0,class:"mt-1 px-4 text-xs text-red-500"},Ve={class:"flex items-center px-4 pt-3 text-[#cccccc]"},Te={class:"w-[70%]"},Fe={class:"flex items-center px-4 py-3"},Ie={class:"w-[30%] text-gray-700",for:"commission"},De=["value"],Me={class:"flex items-center px-4 py-3"},je={class:"w-[30%] text-gray-700"},Ee={value:""},Qe=["value"],qe={key:0,class:"mt-1 px-4 text-xs text-red-500"},ze={class:"flex items-center px-4 py-3"},Be={class:"w-[30%] text-gray-700"},Pe=["placeholder"],Le={key:1,class:"mt-1 px-4 text-xs text-red-500"},Oe={key:2,class:"flex items-center px-4 py-3"},Ae={class:"w-[30%] text-gray-700"},He={class:"w-[70%] flex items-center gap-2 flex-nowrap"},Ke={class:"rounded-lg mb-3 overflow-hidden"},Ue={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},Re={key:0,class:"px-4 py-1 space-y-2"},Ye=["innerHTML"],$e={class:"fixed bottom-14 left-1/2 -translate-x-1/2 w-full max-w-xl px-3 py-2"},Ge=["disabled"],Je=.02,lt=U({__name:"index",setup(We){const{t:o}=J(),b=m(!0),I=m(null),d=m(),S=m(!0),D=m(0),x=m(0),M=m(0),h=m(""),f=Q(()=>d.value?.prize_verify_type||"safeQuestion"),B=Q(()=>Z(ee({amount:z({message:o("mine.transfer.amount-placeholder")}).int(o("mine.transfer.amount-verify-int")).positive(o("mine.transfer.amount-verify-gt0")).refine(l=>l%100===0,{message:o("shop.form-placeholder-1")}).refine(l=>{const t=d.value?.bank_points;return t===void 0||l<=t},{message:o("shop.form-amount-verify-max")}),commission:z().optional(),safe_ask:f.value==="safeQuestion"?N().min(1,o("mine.toolcase.question-options.default")):N().optional(),answer:f.value==="safeQuestion"?N().min(1,o("common.form.placeholder.enter")+o("mine.toolcase.form-label.answer")).max(50,o("mine.security-settings.group-account.password.answer-max")):N().optional()}))),{handleSubmit:P,errors:_,setFieldValue:w,resetForm:L,values:O}=X({validationSchema:B,initialValues:{amount:void 0,commission:0,safe_ask:"",answer:""}}),k=l=>new Intl.NumberFormat("zh-CN").format(l),A=l=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(l),j=async l=>{b.value=!0;try{const{data:t,code:c}=await ae();if(c===200){l&&(I.value=t?.block_content||""),d.value=t,D.value=t.exempt_commission_bank_points||0;const n=t.bank_points||0;t.is_allowed_exchange&&n>=100&&(S.value=!1)}}catch(t){console.error("获取兑换明细失败:",t)}finally{b.value=!1}},H=l=>{const t=l.target,c=Number(t.value.replace(/[^\d]/g,""));w("amount",c||void 0);const n=c*1e3;x.value=n;const K=new te(n).sub(D.value).mul(Je).div(1e3).ceil().toNumber();w("commission",Math.max(0,K))},v=m(!1),E=P(async l=>{if(!d.value?.is_allowed_exchange){y.info(o("shop.verify-is-allowed-exchange",{text:d.value?.gid_name}));return}if(f.value==="smsVerify"&&!h.value){y.error(o("common.sms-verify_code-placeholder"));return}v.value=!0;try{const t=await se({amount:x.value,commission:0,safe_ask:l.safe_ask,answer:l.answer,verify_code:f.value==="smsVerify"?h.value:""}),{code:c,message:n}=t;c!==200?y.error(n):(y.success(n),await j(!1),L(),x.value=0,h.value="",M.value++)}catch{y.error("兑换失败")}finally{v.value=!1}});return R(()=>{j(!0)}),(l,t)=>{const c=Y("router-link");return r(),i("div",ne,[e("div",le,[t[10]||(t[10]=e("header",{class:"h-16 flex items-center justify-center bg-red-600 text-white"},[e("span",{class:"text-white text-2xl font-black tracking-wide"},"商城")],-1)),e("div",ie,[p(c,{to:"/shop/record",class:"flex justify-center items-center px-3 py-3 bg-white rounded-lg"},{default:V(()=>[e("div",re,[u(a(s(o)("shop.tab-1"))+" ",1),p(s(F),{class:"h-5 w-5"})])]),_:1}),p(c,{to:"/mine/toolcase",class:"flex justify-center items-center px-3 py-3 bg-white rounded-lg"},{default:V(()=>[e("div",ce,[u(a(s(o)("shop.tab-2"))+" ",1),p(s(F),{class:"h-5 w-5"})])]),_:1})]),e("div",de,[e("div",me,[e("div",ue,[e("div",null,[e("div",pe,[e("div",fe,a(s(o)("shop.items-1")),1),u(" "+a(k(d.value?.bank_points||0))+" ",1),t[4]||(t[4]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:C},null,-1))]),p(c,{to:"/mine/customer-transfer",class:"flex text-xs text-amber-600"},{default:V(()=>[u(a(s(o)("shop.items-2"))+" ",1),p(s(F),{class:"h-4 w-4"})]),_:1})]),e("div",_e,[e("div",ve,a(s(o)("shop.items-3")),1),u(" "+a(A(d.value?.bank_points_convert||0)),1)])]),e("div",xe,[e("div",null,[e("div",he,[e("div",ge,a(s(o)("shop.items-4")),1),u(" "+a(k(d.value?.points||0))+" ",1),t[5]||(t[5]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:C},null,-1))])]),e("div",ye,[e("div",be,a(s(o)("shop.items-5")),1),u(" "+a(k(d.value?.week_water||0))+" ",1),t[6]||(t[6]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:C},null,-1))])])])]),(r(),i("form",{key:M.value,onSubmit:t[3]||(t[3]=$((...n)=>s(E)&&s(E)(...n),["prevent"])),class:"w-full bg-gray-100 px-3 pb-8"},[e("div",we,[e("div",ke,[e("label",Ce,a(s(o)("shop.form-label-1")),1),e("input",{type:"text",id:"amount",pattern:"[0-9]*",inputmode:"numeric",placeholder:s(o)("shop.form-placeholder-1"),class:"w-[70%] text-gray-600 placeholder-gray-400 focus:outline-none h-10",onInput:H,autocomplete:"off",autocorrect:"off",spellcheck:"false"},null,40,Ne)]),s(_).amount?(r(),i("p",Se,a(s(_).amount),1)):g("",!0),e("div",Ve,[t[8]||(t[8]=e("div",{class:"w-[30%]"},"折合金豆",-1)),e("div",Te,[t[7]||(t[7]=e("img",{src:C,alt:"gold",class:"inline-block ml-1 w-[13px] h-[13px] mr-1"},null,-1)),u(" "+a(x.value>0?k(x.value):0),1)])]),e("div",Fe,[e("label",Ie,a(s(o)("shop.form-label-2")),1),e("input",{type:"text",id:"commission",pattern:"[0-9]*",inputmode:"numeric",disabled:"",value:s(O).commission||0,class:"text-gray-600 w-[70%] placeholder-gray-400 focus:outline-none h-10 bg-transparent"},null,8,De)]),f.value==="safeQuestion"?(r(),i(T,{key:1},[e("div",Me,[e("label",je,a(s(o)("mine.toolcase.form-label.question")),1),e("select",{class:"w-[70%] h-11 text-gray-600 focus:outline-none border rounded-lg px-2",onChange:t[0]||(t[0]=n=>s(w)("safe_ask",n.target.value))},[e("option",Ee,a(b.value?s(o)("common.loading"):s(o)("mine.toolcase.question-options.default")),1),(r(!0),i(T,null,q(s(W),n=>(r(),i("option",{key:n.value,value:String(n.value)},a(s(o)(n.i18nKey)),9,Qe))),128))],32)]),s(_).safe_ask?(r(),i("p",qe,a(s(_).safe_ask),1)):g("",!0),e("div",ze,[e("label",Be,a(s(o)("mine.toolcase.form-label.answer")),1),e("input",{type:"text",placeholder:s(o)("common.form.placeholder.enter")+s(o)("mine.toolcase.form-label.answer"),onInput:t[1]||(t[1]=n=>s(w)("answer",n.target.value)),class:"text-gray-600 w-[70%] placeholder-gray-400 focus:outline-none h-10",autocomplete:"off",autocorrect:"off",spellcheck:"false"},null,40,Pe)]),s(_).answer?(r(),i("p",Le,a(s(_).answer),1)):g("",!0)],64)):g("",!0),f.value==="smsVerify"?(r(),i("div",Oe,[e("label",Ae,a(s(o)("common.sms-verify_code-label")),1),e("div",He,[p(oe,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=n=>h.value=n),scene:"exchange_card",disabled:v.value},null,8,["modelValue","disabled"])])])):g("",!0)]),e("div",Ke,[e("div",Ue,[t[9]||(t[9]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),u(" "+a(s(o)("mine.security-settings.group-account.password.tip")),1)]),b.value?(r(),i("div",Re,[(r(),i(T,null,q(8,n=>e("div",{key:n,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(r(),i("div",{key:1,class:"px-4 py-1 text-gray-600",innerHTML:I.value},null,8,Ye))]),e("div",$e,[e("button",{type:"submit",disabled:v.value||S.value,class:G(["h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide",v.value||S.value?"opacity-60 cursor-not-allowed":"cursor-pointer transition transform active:scale-95"])},a(v.value?s(o)("common.form.button.submitting"):s(o)("common.form.button.submit")),11,Ge)])],32)),t[11]||(t[11]=e("div",{class:"h-18"},null,-1))])])}}});export{lt as default};
