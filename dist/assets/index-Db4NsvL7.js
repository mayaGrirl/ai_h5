import{d as O,r as u,o as H,q as r,l as e,f,n as k,L as d,z as a,u as s,A as J,K as Q,J as C,F as j,t as M,x as R,v as c,c as U}from"./vue-vendor-ntQnFNWs.js";import{_ as b}from"./coin-BjeO1Yvx.js";import{a as Y,t as y,S as G}from"./index-CxBbivxG.js";import{u as W,t as X,o as Z,s as V,n as q}from"./vee-validate-zod-C4UzdXEl.js";import{D as $}from"./utils-vendor-CbLx3nH2.js";import{c as ee,a as te}from"./shop-P_JeA9NN.js";import{C as N}from"./chevron-right-COdj1xIn.js";const se={class:"flex min-h-screen justify-center bg-[#eef3f8]"},oe={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},ae={class:"grid grid-cols-2 gap-2 px-3 pt-3"},ne={class:"text-black flex items-center"},le={class:"text-black flex items-center"},ie={class:"w-full bg-gray-100 px-3 py-4"},re={class:"bg-white rounded-lg mb-3 overflow-hidden"},ce={class:"grid grid-cols-2 gap-2 items-center px-3 pt-3 bg-white border-b rounded-lg"},de={class:"flex items-center gap-1 text-red-500 font-semibold"},me={class:"text-gray-500"},ue={class:"flex items-center gap-1 text-red-500 font-semibold"},pe={class:"text-gray-500"},fe={class:"grid grid-cols-2 gap-2 items-center px-3 py-3 bg-white rounded-lg"},xe={class:"flex items-center gap-1 text-red-500 font-semibold"},_e={class:"text-gray-500"},he={class:"flex items-center gap-1 text-red-500 font-semibold"},ve={class:"text-gray-500"},ge={class:"bg-white rounded-lg mb-3 overflow-hidden"},be={class:"flex items-center px-4 pt-3"},ye={class:"w-[30%] text-gray-700",for:"amount"},we=["placeholder"],ke={key:0,class:"mt-1 px-4 text-xs text-red-500"},Ce={class:"flex items-center px-4 pt-3 text-[#cccccc]"},Ne={class:"w-[70%]"},Se={class:"flex items-center px-4 py-3"},Te={class:"w-[30%] text-gray-700",for:"commission"},Fe=["value"],Ie={class:"flex items-center px-4 py-3"},De={class:"w-[30%] text-gray-700"},je={value:""},Me=["value"],Ve={key:1,class:"mt-1 px-4 text-xs text-red-500"},qe={class:"flex items-center px-4 py-3"},ze={class:"w-[30%] text-gray-700"},Be=["placeholder"],Ee={key:2,class:"mt-1 px-4 text-xs text-red-500"},Le={class:"rounded-lg mb-3 overflow-hidden"},Pe={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},Ae={key:0,class:"px-4 py-1 space-y-2"},Ke=["innerHTML"],Oe={class:"fixed bottom-14 left-1/2 -translate-x-1/2 w-full max-w-xl px-3 py-2"},He=["disabled"],Je=.02,$e=O({__name:"index",setup(Qe){const{t:o}=Y(),h=u(!0),S=u(null),m=u(),w=u(!0),T=u(0),x=u(0),F=u(0),z=U(()=>X(Z({amount:q({message:o("mine.transfer.amount-placeholder")}).int(o("mine.transfer.amount-verify-int")).positive(o("mine.transfer.amount-verify-gt0")).refine(l=>l%100===0,{message:o("shop.form-placeholder-1")}).refine(l=>{const t=m.value?.bank_points;return t===void 0||l<=t},{message:o("shop.form-amount-verify-max")}),commission:q().optional(),safe_ask:V().min(1,o("mine.toolcase.question-options.default")),answer:V().min(1,o("common.form.placeholder.enter")+o("mine.toolcase.form-label.answer")).max(50,o("mine.security-settings.group-account.password.answer-max"))}))),{handleSubmit:B,errors:p,setFieldValue:v,resetForm:E,values:L}=W({validationSchema:z,initialValues:{amount:void 0,commission:0,safe_ask:"",answer:""}}),g=l=>new Intl.NumberFormat("zh-CN").format(l),P=l=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(l),I=async l=>{h.value=!0;try{const{data:t,code:i}=await te();if(i===200){l&&(S.value=t?.block_content||""),m.value=t,T.value=t.exempt_commission_bank_points||0;const n=t.bank_points||0;t.is_allowed_exchange&&n>=100&&(w.value=!1)}}catch(t){console.error("获取兑换明细失败:",t)}finally{h.value=!1}},A=l=>{const t=l.target,i=Number(t.value.replace(/[^\d]/g,""));v("amount",i||void 0);const n=i*1e3;x.value=n;const K=new $(n).sub(T.value).mul(Je).div(1e3).ceil().toNumber();v("commission",Math.max(0,K))},_=u(!1),D=B(async l=>{if(!m.value?.is_allowed_exchange){y.info(o("shop.verify-is-allowed-exchange",{text:m.value?.gid_name}));return}_.value=!0;try{const t=await ee({amount:x.value,commission:0,safe_ask:l.safe_ask,answer:l.answer,verify_code:0}),{code:i,message:n}=t;i!==200?y.error(n):(y.success(n),await I(!1),E(),x.value=0,F.value++)}catch{y.error("兑换失败")}finally{_.value=!1}});return H(()=>{I(!0)}),(l,t)=>{const i=J("router-link");return c(),r("div",se,[e("div",oe,[t[9]||(t[9]=e("header",{class:"h-16 flex items-center justify-center bg-red-600 text-white"},[e("span",{class:"text-white text-2xl font-black tracking-wide"},"商城")],-1)),e("div",ae,[f(i,{to:"/shop/record",class:"flex justify-center items-center px-3 py-3 bg-white rounded-lg"},{default:k(()=>[e("div",ne,[d(a(s(o)("shop.tab-1"))+" ",1),f(s(N),{class:"h-5 w-5"})])]),_:1}),f(i,{to:"/mine/toolcase",class:"flex justify-center items-center px-3 py-3 bg-white rounded-lg"},{default:k(()=>[e("div",le,[d(a(s(o)("shop.tab-2"))+" ",1),f(s(N),{class:"h-5 w-5"})])]),_:1})]),e("div",ie,[e("div",re,[e("div",ce,[e("div",null,[e("div",de,[e("div",me,a(s(o)("shop.items-1")),1),d(" "+a(g(m.value?.bank_points||0))+" ",1),t[3]||(t[3]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:b},null,-1))]),f(i,{to:"/mine/customer-transfer",class:"flex text-xs text-amber-600"},{default:k(()=>[d(a(s(o)("shop.items-2"))+" ",1),f(s(N),{class:"h-4 w-4"})]),_:1})]),e("div",ue,[e("div",pe,a(s(o)("shop.items-3")),1),d(" "+a(P(m.value?.bank_points_convert||0)),1)])]),e("div",fe,[e("div",null,[e("div",xe,[e("div",_e,a(s(o)("shop.items-4")),1),d(" "+a(g(m.value?.points||0))+" ",1),t[4]||(t[4]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:b},null,-1))])]),e("div",he,[e("div",ve,a(s(o)("shop.items-5")),1),d(" "+a(g(m.value?.week_water||0))+" ",1),t[5]||(t[5]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:b},null,-1))])])])]),(c(),r("form",{key:F.value,onSubmit:t[2]||(t[2]=Q((...n)=>s(D)&&s(D)(...n),["prevent"])),class:"w-full bg-gray-100 px-3 pb-8"},[e("div",ge,[e("div",be,[e("label",ye,a(s(o)("shop.form-label-1")),1),e("input",{type:"text",id:"amount",pattern:"[0-9]*",inputmode:"numeric",placeholder:s(o)("shop.form-placeholder-1"),class:"w-[70%] text-gray-600 placeholder-gray-400 focus:outline-none h-10",onInput:A,autocomplete:"off",autocorrect:"off",spellcheck:"false"},null,40,we)]),s(p).amount?(c(),r("p",ke,a(s(p).amount),1)):C("",!0),e("div",Ce,[t[7]||(t[7]=e("div",{class:"w-[30%]"},"折合金豆",-1)),e("div",Ne,[t[6]||(t[6]=e("img",{src:b,alt:"gold",class:"inline-block ml-1 w-[13px] h-[13px] mr-1"},null,-1)),d(" "+a(x.value>0?g(x.value):0),1)])]),e("div",Se,[e("label",Te,a(s(o)("shop.form-label-2")),1),e("input",{type:"text",id:"commission",pattern:"[0-9]*",inputmode:"numeric",disabled:"",value:s(L).commission||0,class:"text-gray-600 w-[70%] placeholder-gray-400 focus:outline-none h-10 bg-transparent"},null,8,Fe)]),e("div",Ie,[e("label",De,a(s(o)("mine.toolcase.form-label.question")),1),e("select",{class:"w-[70%] h-11 text-gray-600 focus:outline-none border rounded-lg px-2",onChange:t[0]||(t[0]=n=>s(v)("safe_ask",n.target.value))},[e("option",je,a(h.value?s(o)("common.loading"):s(o)("mine.toolcase.question-options.default")),1),(c(!0),r(j,null,M(s(G),n=>(c(),r("option",{key:n.value,value:String(n.value)},a(s(o)(n.i18nKey)),9,Me))),128))],32)]),s(p).safe_ask?(c(),r("p",Ve,a(s(p).safe_ask),1)):C("",!0),e("div",qe,[e("label",ze,a(s(o)("mine.toolcase.form-label.answer")),1),e("input",{type:"text",placeholder:s(o)("common.form.placeholder.enter")+s(o)("mine.toolcase.form-label.answer"),onInput:t[1]||(t[1]=n=>s(v)("answer",n.target.value)),class:"text-gray-600 w-[70%] placeholder-gray-400 focus:outline-none h-10",autocomplete:"off",autocorrect:"off",spellcheck:"false"},null,40,Be)]),s(p).answer?(c(),r("p",Ee,a(s(p).answer),1)):C("",!0)]),e("div",Le,[e("div",Pe,[t[8]||(t[8]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),d(" "+a(s(o)("mine.security-settings.group-account.password.tip")),1)]),h.value?(c(),r("div",Ae,[(c(),r(j,null,M(8,n=>e("div",{key:n,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(c(),r("div",{key:1,class:"px-4 py-1 text-gray-600",innerHTML:S.value},null,8,Ke))]),e("div",Oe,[e("button",{type:"submit",disabled:_.value||w.value,class:R(["h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide",_.value||w.value?"opacity-60 cursor-not-allowed":"cursor-pointer transition transform active:scale-95"])},a(_.value?s(o)("common.form.button.submitting"):s(o)("common.form.button.submit")),11,He)])],32)),t[10]||(t[10]=e("div",{class:"h-18"},null,-1))])])}}});export{$e as default};
