import{d as w,o as k,b as v,q as n,n as s,C as f,f as g,y as i,S as b,U as C,r as D,c as S,F as j,t as L,D as M,l as r,x as c}from"./vue-vendor-2ZNhN7Rr.js";import{u as B}from"./im-CEEchYxF.js";import{A as T}from"./arrow-left-DS648bW8.js";import{c as N}from"./index-CIZoSaJ3.js";import{M as V}from"./message-circle-mwYy_fid.js";import"./utils-vendor-CbLx3nH2.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=N("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),q={class:"flex h-full flex-col bg-gray-50"},z={class:"sticky top-0 z-10 flex h-12 items-center justify-between bg-white px-4 shadow-sm"},I={class:"bg-white px-4 py-2"},U={class:"flex items-center rounded-full bg-gray-100 px-3 py-2"},A={key:0,class:"bg-yellow-50 px-4 py-2 text-center text-xs text-yellow-600"},E={key:0},F={key:1},H={key:2},K={class:"flex-1 overflow-y-auto"},P={key:0,class:"flex items-center justify-center py-8"},R={key:1,class:"flex flex-col items-center justify-center py-16"},G={key:2,class:"divide-y divide-gray-100 bg-white"},J=["onClick"],O={class:"relative flex-shrink-0"},Q=["src","alt"],W={key:0,class:"absolute -right-1 -top-1 h-2 w-2 rounded-full bg-orange-400"},X={class:"ml-3 flex-1 overflow-hidden"},Y={class:"flex items-center justify-between"},Z={class:"truncate text-sm font-medium text-gray-900"},ee={class:"ml-2 flex-shrink-0 text-xs text-gray-400"},te={class:"mt-1 flex items-center justify-between"},se={class:"truncate text-xs text-gray-500"},ne={key:0,class:"ml-2 flex h-5 min-w-[20px] flex-shrink-0 items-center justify-center rounded-full bg-red-500 px-1.5 text-xs font-medium text-white"},re={key:1,class:"ml-2 text-gray-400"},fe=w({__name:"index",setup(ae){const y=M(),o=B(),l=D(""),u=S(()=>{if(!l.value)return o.sortedConversations;const a=l.value.toLowerCase();return o.sortedConversations.filter(e=>e.name.toLowerCase().includes(a))});function x(a){const e=new Date(a),t=new Date,d=t.getTime()-e.getTime();if(e.toDateString()===t.toDateString())return e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});const m=new Date(t);return m.setDate(m.getDate()-1),e.toDateString()===m.toDateString()?"昨天":d<10080*60*1e3?["周日","周一","周二","周三","周四","周五","周六"][e.getDay()]:`${e.getMonth()+1}/${e.getDate()}`}function p(a){if(!a.last_message)return"";if(a.last_message.is_recalled)return"[消息已撤回]";switch(a.last_message.type){case 1:return a.last_message.content||"";case 2:return"[图片]";case 3:return"[语音]";case 4:return"[视频]";case 5:return"[文件]";default:return a.last_message.content||""}}function _(a){y.push(`/im/chat/${a.id}`)}function h(){y.back()}return k(async()=>{await o.init()}),v(()=>{}),(a,e)=>(r(),n("div",q,[s("header",z,[s("button",{onClick:h,class:"flex h-8 w-8 items-center justify-center rounded-full hover:bg-gray-100"},[g(i(T),{class:"h-5 w-5 text-gray-600"})]),e[2]||(e[2]=s("h1",{class:"text-base font-medium text-gray-900"},"消息",-1)),e[3]||(e[3]=s("div",{class:"w-8"},null,-1))]),s("div",I,[s("div",U,[g(i($),{class:"h-4 w-4 text-gray-400"}),b(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.value=t),type:"text",placeholder:"搜索会话",class:"ml-2 flex-1 bg-transparent text-sm outline-none placeholder:text-gray-400"},null,512),[[C,l.value]])])]),i(o).isConnected?f("",!0):(r(),n("div",A,[i(o).connectionState==="connecting"?(r(),n("span",E,"连接中...")):i(o).connectionState==="reconnecting"?(r(),n("span",F,"重新连接中...")):(r(),n("span",H,"未连接"))])),s("div",K,[i(o).isLoading&&u.value.length===0?(r(),n("div",P,[...e[4]||(e[4]=[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},null,-1)])])):u.value.length===0?(r(),n("div",R,[g(i(V),{class:"h-16 w-16 text-gray-300"}),e[5]||(e[5]=s("p",{class:"mt-4 text-sm text-gray-400"},"暂无消息",-1))])):(r(),n("div",G,[(r(!0),n(j,null,L(u.value,t=>(r(),n("div",{key:t.id,onClick:d=>_(t),class:"flex cursor-pointer items-center px-4 py-3 transition-colors active:bg-gray-50"},[s("div",O,[s("img",{src:t.avatar||t.target?.avatar||"/default-avatar.png",alt:t.name,class:"h-12 w-12 rounded-full object-cover",onError:e[1]||(e[1]=d=>d.target.src="/default-avatar.png")},null,40,Q),t.is_pinned?(r(),n("div",W)):f("",!0)]),s("div",X,[s("div",Y,[s("span",Z,c(t.name||t.target?.nickname||"未知"),1),s("span",ee,c(t.last_message?x(t.last_message.created_at):""),1)]),s("div",te,[s("p",se,c(p(t)),1),t.unread_count>0?(r(),n("span",ne,c(t.unread_count>99?"99+":t.unread_count),1)):t.notify_mode===0?(r(),n("span",re,[...e[6]||(e[6]=[s("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})],-1)])])):f("",!0)])])],8,J))),128))]))])]))}});export{fe as default};
