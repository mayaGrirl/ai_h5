import{d as P,o as T,r as p,q as u,n as e,f as U,y as a,M as q,C as f,N as _,x as l,S as y,V as b,k as w,W as z,F as k,t as S,U as D,u as j,l as i,D as I}from"./vue-vendor-2ZNhN7Rr.js";import{a as O,S as F,t as g}from"./index-CIZoSaJ3.js";import{h as K}from"./customer-CDJyDjhM.js";import{g as L,h as $}from"./common-PQj6D7Hk.js";import{E as C,a as V,S as M}from"./sodium-Usr4fYW5.js";import{_ as H}from"./PageHeader.vue_vue_type_script_setup_true_lang-BnPQ6QDM.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-DCF22wfj.js";const R={class:"flex min-h-screen justify-center bg-[#eef3f8]"},A={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},Q={class:"bg-gray-100 flex justify-center"},W={class:"bg-white rounded-lg mb-3 overflow-hidden"},G={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},J={class:"flex items-center px-4 py-3 border-b"},X={class:"w-2/7 text-gray-700"},Y={class:"w-5/7 relative"},Z=["type","placeholder"],ee={key:0,class:"mt-1 px-4 text-xs text-red-500"},se={class:"flex items-center px-4 py-3"},te={class:"w-2/7 text-gray-700"},ae={class:"w-5/7 relative"},oe=["type","placeholder"],re={key:1,class:"mt-1 px-4 text-xs text-red-500"},ne={class:"bg-white rounded-lg mb-3 overflow-hidden"},le={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},ie={class:"flex items-center px-4 py-3 border-b"},ue={class:"w-2/7 text-gray-700"},de={value:""},ce=["value"],pe={key:0,class:"mt-1 px-4 text-xs text-red-500"},me={class:"flex items-center px-4 py-3"},fe={class:"w-2/7 text-gray-700"},ye=["placeholder"],we={key:1,class:"mt-1 px-4 text-xs text-red-500"},ve={class:"rounded-lg mb-3 overflow-hidden"},_e={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},ge={key:0,class:"px-4 py-3 space-y-2"},xe=["innerHTML"],he=["disabled"],Te=P({__name:"pay-password",setup(be){const E=I(),{t}=O(),x=p(!0),h=p(""),c=p(!1),m=p(!1),v=p(""),o=p({safe_ask:"",answer:"",password:"",confirm_password:""}),n=p({}),N=()=>(n.value={},o.value.safe_ask?o.value.answer?o.value.answer.length>50?(n.value.answer=t("mine.security-settings.group-account.password.answer-max"),!1):!o.value.password||o.value.password.length<8?(n.value.password=t("mine.security-settings.group-account.pay-password.password-min"),!1):o.value.password!==o.value.confirm_password?(n.value.confirm_password=t("mine.security-settings.group-account.password.confirm-password-eq"),!1):!0:(n.value.answer=t("common.form.placeholder.enter")+t("mine.toolcase.form-label.answer"),!1):(n.value.safe_ask=t("mine.toolcase.question-options.default"),!1)),B=async()=>{if(N()){m.value=!0;try{const d=await M.encrypt(o.value.password,v.value),s=await M.encrypt(o.value.confirm_password,v.value),r=await K({safe_ask:o.value.safe_ask,answer:o.value.answer,password:d,confirm_password:s});r.code===200?(g.success(r.message||"修改成功"),E.back()):g.error(r.message||"修改失败")}catch{g.error("修改失败")}finally{m.value=!1}}};return T(async()=>{try{const d=await L("customer_pay_password_tips");h.value=d.data?.content||""}catch(d){console.error("加载提示内容失败",d)}finally{x.value=!1}$().then(({data:d,code:s})=>{s===200&&(v.value=d.key)})}),(d,s)=>(i(),u("div",R,[e("div",A,[U(H,{title:a(t)("mine.setting.edit-pay-password")},null,8,["title"]),e("div",Q,[e("form",{onSubmit:q(B,["prevent"]),class:"w-full bg-gray-100 px-3 py-4"},[e("div",W,[e("div",G,[s[6]||(s[6]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),_(" "+l(a(t)("mine.security-settings.group-account.pay-password.password")),1)]),e("div",J,[e("label",X,l(a(t)("mine.security-settings.group-account.pay-password.password")),1),e("div",Y,[y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.pay-password.password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,Z),[[b,o.value.password]]),e("button",{type:"button",onClick:s[1]||(s[1]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),w(a(C),{key:0,size:18})):(i(),w(a(V),{key:1,size:18}))])])]),n.value.password?(i(),u("p",ee,l(n.value.password),1)):f("",!0),e("div",se,[e("label",te,l(a(t)("mine.security-settings.group-account.pay-password.confirm-password")),1),e("div",ae,[y(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.confirm_password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.pay-password.confirm-password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,oe),[[b,o.value.confirm_password]]),e("button",{type:"button",onClick:s[3]||(s[3]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),w(a(C),{key:0,size:18})):(i(),w(a(V),{key:1,size:18}))])])]),n.value.confirm_password?(i(),u("p",re,l(n.value.confirm_password),1)):f("",!0)]),e("div",ne,[e("div",le,[s[7]||(s[7]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),_(" "+l(a(t)("mine.security-settings.group-account.password.safe-ask-valid")),1)]),e("div",ie,[e("label",ue,l(a(t)("mine.toolcase.form-label.question")),1),y(e("select",{"onUpdate:modelValue":s[4]||(s[4]=r=>o.value.safe_ask=r),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},[e("option",de,l(a(t)("mine.toolcase.question-options.default")),1),(i(!0),u(k,null,S(a(F),r=>(i(),u("option",{key:r.value,value:r.value},l(a(t)(r.i18nKey)),9,ce))),128))],512),[[z,o.value.safe_ask]])]),n.value.safe_ask?(i(),u("p",pe,l(n.value.safe_ask),1)):f("",!0),e("div",me,[e("label",fe,l(a(t)("mine.toolcase.form-label.answer")),1),y(e("input",{"onUpdate:modelValue":s[5]||(s[5]=r=>o.value.answer=r),type:"text",placeholder:a(t)("common.form.placeholder.enter")+a(t)("mine.toolcase.form-label.answer"),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},null,8,ye),[[D,o.value.answer]])]),n.value.answer?(i(),u("p",we,l(n.value.answer),1)):f("",!0)]),e("div",ve,[e("div",_e,[s[8]||(s[8]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),_(" "+l(a(t)("mine.security-settings.group-account.password.tip")),1)]),x.value?(i(),u("div",ge,[(i(),u(k,null,S(3,r=>e("div",{key:r,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(i(),u("div",{key:1,class:"px-4 py-3 text-gray-600",innerHTML:h.value},null,8,xe))]),e("button",{type:"submit",disabled:m.value,class:j(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",m.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},l(m.value?a(t)("common.form.button.submitting"):a(t)("common.form.button.submit")),11,he)],32)]),s[9]||(s[9]=e("div",{class:"h-14"},null,-1))])]))}});export{Te as default};
