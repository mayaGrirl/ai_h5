import{d as U,o as q,r as p,q as u,n as e,f as z,y as a,M as D,C as f,N as g,x as l,S as w,V as b,k as v,W as P,F as k,t as S,U as j,u as I,l as i,D as L}from"./vue-vendor-2ZNhN7Rr.js";import{a as O,u as F,S as K,t as _}from"./index-CL3zLPQY.js";import{f as $}from"./customer-BiAoQat5.js";import{g as A,h as H}from"./common-C0Vzt5Ew.js";import{E as C,a as V,S as M}from"./sodium-BoWtdtrh.js";import{_ as R}from"./PageHeader.vue_vue_type_script_setup_true_lang-BqWK2P6g.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-8uYLpLhl.js";const Q={class:"flex min-h-screen justify-center bg-[#eef3f8]"},W={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},G={class:"bg-gray-100 flex justify-center"},J={class:"bg-white rounded-lg mb-3 overflow-hidden"},X={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},Y={class:"flex items-center px-4 py-3 border-b"},Z={class:"w-2/7 text-gray-700"},ee={class:"w-5/7 relative"},se=["type","placeholder"],te={key:0,class:"mt-1 px-4 text-xs text-red-500"},ae={class:"flex items-center px-4 py-3"},oe={class:"w-2/7 text-gray-700"},re={class:"w-5/7 relative"},ne=["type","placeholder"],le={key:1,class:"mt-1 px-4 text-xs text-red-500"},ie={class:"bg-white rounded-lg mb-3 overflow-hidden"},ue={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},de={class:"flex items-center px-4 py-3 border-b"},ce={class:"w-2/7 text-gray-700"},pe={value:""},me=["value"],fe={key:0,class:"mt-1 px-4 text-xs text-red-500"},we={class:"flex items-center px-4 py-3"},ve={class:"w-2/7 text-gray-700"},ye=["placeholder"],ge={key:1,class:"mt-1 px-4 text-xs text-red-500"},_e={class:"rounded-lg mb-3 overflow-hidden"},xe={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},he={key:0,class:"px-4 py-3 space-y-2"},be=["innerHTML"],ke=["disabled"],ze=U({__name:"login-password",setup(Se){const E=L(),{t}=O(),N=F(),x=p(!0),h=p(""),c=p(!1),m=p(!1),y=p(""),o=p({safe_ask:"",answer:"",password:"",confirm_password:""}),n=p({}),B=()=>(n.value={},o.value.safe_ask?o.value.answer?o.value.answer.length>50?(n.value.answer=t("mine.security-settings.group-account.password.answer-max"),!1):!o.value.password||o.value.password.length<8?(n.value.password=t("mine.security-settings.group-account.password.login-password-min"),!1):o.value.password!==o.value.confirm_password?(n.value.confirm_password=t("mine.security-settings.group-account.password.confirm-password-eq"),!1):!0:(n.value.answer=t("common.form.placeholder.enter")+t("mine.toolcase.form-label.answer"),!1):(n.value.safe_ask=t("mine.toolcase.question-options.default"),!1)),T=async()=>{if(B()){m.value=!0;try{const d=await M.encrypt(o.value.password,y.value),s=await M.encrypt(o.value.confirm_password,y.value),r=await $({safe_ask:o.value.safe_ask,answer:o.value.answer,password:d,confirm_password:s});r.code===200?(_.success(r.message||"修改成功"),N.logout(),E.replace("/auth/login")):_.error(r.message||"修改失败")}catch{_.error("修改失败")}finally{m.value=!1}}};return q(async()=>{try{const d=await A("customer_reset_login_password_tips");h.value=d.data?.content||""}catch(d){console.error("加载提示内容失败",d)}finally{x.value=!1}H().then(({data:d,code:s})=>{s===200&&(y.value=d.key)})}),(d,s)=>(i(),u("div",Q,[e("div",W,[z(R,{title:a(t)("mine.setting.edit-password")},null,8,["title"]),e("div",G,[e("form",{onSubmit:D(T,["prevent"]),class:"w-full bg-gray-100 px-3 py-4"},[e("div",J,[e("div",X,[s[6]||(s[6]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),g(" "+l(a(t)("mine.security-settings.group-account.password.login-password")),1)]),e("div",Y,[e("label",Z,l(a(t)("mine.security-settings.group-account.password.login-password")),1),e("div",ee,[w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.password.login-password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,se),[[b,o.value.password]]),e("button",{type:"button",onClick:s[1]||(s[1]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),v(a(C),{key:0,size:18})):(i(),v(a(V),{key:1,size:18}))])])]),n.value.password?(i(),u("p",te,l(n.value.password),1)):f("",!0),e("div",ae,[e("label",oe,l(a(t)("mine.security-settings.group-account.password.confirm-password")),1),e("div",re,[w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.confirm_password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.password.confirm-password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,ne),[[b,o.value.confirm_password]]),e("button",{type:"button",onClick:s[3]||(s[3]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),v(a(C),{key:0,size:18})):(i(),v(a(V),{key:1,size:18}))])])]),n.value.confirm_password?(i(),u("p",le,l(n.value.confirm_password),1)):f("",!0)]),e("div",ie,[e("div",ue,[s[7]||(s[7]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),g(" "+l(a(t)("mine.security-settings.group-account.password.safe-ask-valid")),1)]),e("div",de,[e("label",ce,l(a(t)("mine.toolcase.form-label.question")),1),w(e("select",{"onUpdate:modelValue":s[4]||(s[4]=r=>o.value.safe_ask=r),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},[e("option",pe,l(a(t)("mine.toolcase.question-options.default")),1),(i(!0),u(k,null,S(a(K),r=>(i(),u("option",{key:r.value,value:r.value},l(a(t)(r.i18nKey)),9,me))),128))],512),[[P,o.value.safe_ask]])]),n.value.safe_ask?(i(),u("p",fe,l(n.value.safe_ask),1)):f("",!0),e("div",we,[e("label",ve,l(a(t)("mine.toolcase.form-label.answer")),1),w(e("input",{"onUpdate:modelValue":s[5]||(s[5]=r=>o.value.answer=r),type:"text",placeholder:a(t)("common.form.placeholder.enter")+a(t)("mine.toolcase.form-label.answer"),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},null,8,ye),[[j,o.value.answer]])]),n.value.answer?(i(),u("p",ge,l(n.value.answer),1)):f("",!0)]),e("div",_e,[e("div",xe,[s[8]||(s[8]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),g(" "+l(a(t)("mine.security-settings.group-account.password.tip")),1)]),x.value?(i(),u("div",he,[(i(),u(k,null,S(3,r=>e("div",{key:r,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(i(),u("div",{key:1,class:"px-4 py-3 text-gray-600",innerHTML:h.value},null,8,be))]),e("button",{type:"submit",disabled:m.value,class:I(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",m.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},l(m.value?a(t)("common.form.button.submitting"):a(t)("common.form.button.submit")),11,ke)],32)]),s[9]||(s[9]=e("div",{class:"h-14"},null,-1))])]))}});export{ze as default};
