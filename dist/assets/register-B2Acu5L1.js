import{d as U,o as $,r,q as w,l as e,f as F,K as H,z as u,u as o,Q as j,R as O,x as E,S as L,k as b,L as z,F as G,t as Q,n as Y,A as J,I as W,B as X,v as d,c as Z}from"./vue-vendor-ntQnFNWs.js";import{_ as ee}from"./login-logo-DOFsqlSQ.js";import{a as te,u as se,s as oe,t as m,r as ae}from"./index-C6XK1gma.js";import{h as re,a as le}from"./common-v3aAoxrt.js";import{E as D,a as R,S as V}from"./sodium-FupA2cUO.js";import"./utils-vendor-CbLx3nH2.js";const ne={class:"flex min-h-screen justify-center bg-[#eef3f8]"},ie={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},ce={class:"px-3 pb-20 pt-3"},ue={class:"bg-white rounded-xl shadow-sm p-2"},de={class:"flex justify-center items-center border-b border-gray-200"},me={class:"w-1/4 text-gray-700"},ve={class:"w-3/4"},pe=["placeholder","value"],fe={class:"flex justify-center items-center border-b border-gray-200"},ye={class:"w-1/4 text-gray-700"},ge={class:"flex w-3/4 items-center gap-2 flex-wrap sm:flex-nowrap"},he=["placeholder"],_e=["disabled"],we={class:"flex justify-center items-center border-b border-gray-200"},be={class:"w-1/4 text-gray-700"},xe={class:"w-3/4 relative"},ke=["type","placeholder"],Se={class:"flex justify-center items-center"},Ce={class:"w-1/4 text-gray-700"},Te={class:"w-3/4 relative"},je=["type","placeholder"],Me={class:"rounded-lg mb-3 overflow-hidden"},Ie={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},Ee={key:0,class:"px-4 py-3 space-y-2"},Le=["innerHTML"],ze=["disabled"],h="sms_countdown_end_at_register",Ne=U({__name:"register",setup(De){const A=W(),B=X(),{t:s}=te(),M=se(),v=r(""),_=r(""),y=r(""),g=r(""),c=r(!1),p=r(!1),f=r(!1),n=r(0),x=r(""),k=r(!0),I=r(""),S=r(!0),P=Z(()=>A.query.t||"");let C=null;$(async()=>{const l=Number(localStorage.getItem(h));if(l){const t=Math.floor((l-Date.now())/1e3);t>0?(n.value=t,T()):localStorage.removeItem(h)}re().then(({data:t,code:a})=>{a===200&&(x.value=t.key)}),S.value=!0;try{const{data:t}=await le();I.value=t?.content||""}catch{}finally{S.value=!1}});const T=()=>{if(C&&clearTimeout(C),n.value<=0){localStorage.removeItem(h);return}C=setTimeout(()=>{n.value--,n.value<=0?localStorage.removeItem(h):T()},1e3)},K=async()=>{if(!(!v.value||f.value||n.value>0)){f.value=!0;try{const l=await oe(v.value);if(l.code===200){n.value=60;const a=Date.now()+60*1e3;localStorage.setItem(h,String(a)),T(),m.success(l.message||"发送成功")}else m.error(l.message||s("common.sms-verify_code-send-failed"))}catch{m.error(s("common.sms-verify_code-send-failed"))}finally{f.value=!1}}},N=async()=>{if(!(!v.value||!_.value||!y.value||!g.value||p.value)){if(y.value!==g.value){m.error(s("register.confirm_password-eq"));return}p.value=!0;try{const l=await V.encrypt(y.value,x.value),t=await V.encrypt(g.value,x.value),a=await ae({mobile:v.value,verify_code:_.value,password:l,confirm_password:t,recommend:P.value||""});a.code===200&&a.data?.access_token?(m.success(a.message||"注册成功"),M.setToken(a.data.access_token,a.data.token_type,a.data.expires_at),await M.fetchCurrentCustomer(),B.replace("/")):m.error(a.message||s("common.catch-error"))}catch{m.error(s("common.catch-error"))}finally{p.value=!1}}},q=l=>{const t=l.target;v.value=t.value,k.value=t.value.length===0};return(l,t)=>{const a=J("router-link");return d(),w("div",ne,[e("div",ie,[e("main",ce,[t[6]||(t[6]=e("div",{class:"pt-13 flex items-center justify-center"},[e("img",{src:ee,alt:"Login",class:"w-32 h-auto"})],-1)),e("form",{onSubmit:H(N,["prevent"]),class:"mt-5"},[e("div",ue,[e("div",de,[e("label",me,u(o(s)("register.mobile-label")),1),e("div",ve,[e("input",{type:"text",placeholder:o(s)("register.mobile-placeholder"),value:v.value,onInput:q,class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,40,pe)])]),e("div",fe,[e("label",ye,u(o(s)("common.sms-verify_code-label")),1),e("div",ge,[j(e("input",{type:"text",placeholder:o(s)("common.sms-verify_code-placeholder"),"onUpdate:modelValue":t[0]||(t[0]=i=>_.value=i),class:"flex-1 min-w-0 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,he),[[O,_.value]]),e("button",{type:"button",disabled:n.value>0||f.value||k.value,onClick:K,class:E(["shrink-0 h-8 px-3 rounded text-xs whitespace-nowrap transition",n.value>0||f.value||k.value?"bg-gray-600 text-white cursor-not-allowed":"bg-blue-600 text-white active:scale-95 cursor-pointer"])},u(f.value?o(s)("common.sms-verify_code-sending"):n.value>0?`${n.value}s`:o(s)("common.sms-verify_code-send-btn")),11,_e)])]),e("div",we,[e("label",be,u(o(s)("register.password-label")),1),e("div",xe,[j(e("input",{type:c.value?"text":"password","onUpdate:modelValue":t[1]||(t[1]=i=>y.value=i),placeholder:o(s)("register.password-placeholder"),class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,ke),[[L,y.value]]),e("button",{type:"button",tabindex:"-1",onClick:t[2]||(t[2]=i=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(d(),b(o(D),{key:0,size:18})):(d(),b(o(R),{key:1,size:18}))])])]),e("div",Se,[e("label",Ce,u(o(s)("register.confirm_password-label")),1),e("div",Te,[j(e("input",{type:c.value?"text":"password","onUpdate:modelValue":t[3]||(t[3]=i=>g.value=i),placeholder:o(s)("register.confirm_password-placeholder"),class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,je),[[L,g.value]]),e("button",{type:"button",tabindex:"-1",onClick:t[4]||(t[4]=i=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(d(),b(o(D),{key:0,size:18})):(d(),b(o(R),{key:1,size:18}))])])])]),e("div",Me,[e("div",Ie,[t[5]||(t[5]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),z(" "+u(o(s)("mine.security-settings.group-account.password.tip")),1)]),S.value?(d(),w("div",Ee,[(d(),w(G,null,Q(3,i=>e("div",{key:i,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(d(),w("div",{key:1,class:"px-4 py-3 text-gray-600",innerHTML:I.value},null,8,Le))]),e("button",{type:"submit",disabled:p.value,class:E(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",p.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},u(p.value?o(s)("common.form.button.submitting"):o(s)("register.form-submit-button")),11,ze)],32),F(a,{to:"/auth/login",class:"flex justify-center items-center mt-6 text-[rgb(0,0,238)]"},{default:Y(()=>[z(u(o(s)("register.back-login")),1)]),_:1})])])])}}});export{Ne as default};
