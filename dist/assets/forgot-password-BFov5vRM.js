import{d as A,o as K,r as l,q as P,n as e,u as _,y as s,x as r,k as x,C as q,M as I,S as D,U as O,V as M,p as G,E as Y,l as f,N as F,D as H}from"./vue-vendor-2ZNhN7Rr.js";import{_ as J}from"./login-logo-DOFsqlSQ.js";import{a as Q,f as W,t as i,e as X,g as Z}from"./index-CL3zLPQY.js";import{h as ee}from"./common-C0Vzt5Ew.js";import{E as T,a as z,S as N}from"./sodium-BoWtdtrh.js";import{c as k}from"./index-C6jzfBHC.js";import"./utils-vendor-CbLx3nH2.js";const te={class:"flex min-h-screen justify-center bg-[#eef3f8]"},se={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},oe={class:"px-4 pt-4"},ae={class:"flex items-center justify-between text-sm p-14 pt-0 pb-0"},le={class:"flex items-center gap-2"},re={class:"flex items-center gap-2"},ne={class:"px-3 pb-20 pt-4"},ie={class:"bg-white rounded-xl shadow-sm p-3"},ce={class:"flex justify-center items-center border-b border-gray-200"},ue={class:"w-1/4 text-gray-700"},de={class:"w-3/4"},me=["placeholder","value"],fe={class:"flex justify-center items-center"},ve={class:"w-1/4 text-gray-700"},pe={class:"flex w-3/4 items-center gap-2"},ge=["placeholder"],ye=["disabled"],be=["disabled"],he={class:"bg-white rounded-xl shadow-sm p-3"},we={class:"flex justify-center items-center border-b border-gray-200"},_e={class:"w-1/4 text-gray-700"},xe={class:"w-3/4 relative"},ke=["type","placeholder"],Se={class:"flex justify-center items-center"},Ce={class:"w-1/4 text-gray-700"},je={class:"w-3/4 relative"},Ve=["type","placeholder"],Ee=["disabled"],S="sms_countdown_end_at_find_password",Be=A({__name:"forgot-password",setup(Pe){const R=H(),{t:o}=Q(),u=l(1),v=l(""),g=l(""),y=l(!1),b=l(""),h=l(""),d=l(!1),w=l(!1),p=l(!1),n=l(0),C=l(""),j=l(!0);let V=null;K(()=>{const a=Number(localStorage.getItem(S));if(a){const t=Math.floor((a-Date.now())/1e3);t>0?(n.value=t,E()):localStorage.removeItem(S)}ee().then(({data:t,code:c})=>{c===200&&(C.value=t.key)})});const E=()=>{if(V&&clearTimeout(V),n.value<=0){localStorage.removeItem(S);return}V=setTimeout(()=>{n.value--,n.value<=0?localStorage.removeItem(S):E()},1e3)},B=async()=>{if(!(!v.value||p.value||n.value>0)){p.value=!0;try{const a=await W(v.value);if(a.code===200){n.value=60;const c=Date.now()+60*1e3;localStorage.setItem(S,String(c)),E(),i.success(a.message||"发送成功")}else i.error(a.message||o("common.sms-verify_code-send-failed"))}catch{i.error(o("common.sms-verify_code-send-failed"))}finally{p.value=!1}}},L=async()=>{if(!(!v.value||!g.value||y.value)){y.value=!0;try{const a=await X({mobile:v.value,verify_code:g.value,password:"",confirm_password:""});a.code===200?(i.success(a.message||"验证成功"),u.value=2):i.error(a.message||o("common.catch-error"))}catch{i.error(o("common.catch-error"))}finally{y.value=!1}}},U=async()=>{if(!(!b.value||!h.value||w.value)){if(b.value!==h.value){i.error(o("register.confirm_password-eq"));return}w.value=!0;try{const a=await N.encrypt(b.value,C.value),t=await N.encrypt(h.value,C.value),c=await Z({mobile:v.value,verify_code:g.value,password:a,confirm_password:t});c.code===200?(i.success(c.message||"重置成功"),R.replace("/auth/login")):i.error(c.message||o("common.catch-error"))}catch{i.error(o("common.catch-error"))}finally{w.value=!1}}},$=a=>{const t=a.target;v.value=t.value,j.value=t.value.length===0};return(a,t)=>{const c=Y("router-link");return f(),P("div",te,[e("div",se,[t[7]||(t[7]=e("div",{class:"pt-13 flex items-center justify-center"},[e("img",{src:J,alt:"Login",class:"w-32 h-auto"})],-1)),e("div",oe,[e("div",ae,[e("div",le,[e("span",{class:_(s(k)("h-2.5 w-2.5 rounded-full",u.value===1?"bg-red-600":"bg-gray-300"))},null,2),e("span",{class:_(s(k)(u.value===1?"text-gray-900 font-medium":"text-gray-500"))},r(s(o)("forgot-password.submit-step1")),3)]),t[6]||(t[6]=e("div",{class:"flex-1 mx-2 h-[1px] bg-gray-200"},null,-1)),e("div",re,[e("span",{class:_(s(k)("h-2.5 w-2.5 rounded-full",u.value===2?"bg-red-600":"bg-gray-300"))},null,2),e("span",{class:_(s(k)(u.value===2?"text-gray-900 font-medium":"text-gray-500"))},r(s(o)("forgot-password.submit-step2")),3)])])]),e("main",ne,[u.value===1?(f(),P("form",{key:0,onSubmit:I(L,["prevent"]),class:"space-y-3"},[e("div",ie,[e("div",ce,[e("label",ue,r(s(o)("register.mobile-label")),1),e("div",de,[e("input",{type:"text",placeholder:s(o)("register.mobile-placeholder"),value:v.value,onInput:$,class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,40,me)])]),e("div",fe,[e("label",ve,r(s(o)("common.sms-verify_code-label")),1),e("div",pe,[D(e("input",{type:"text",placeholder:s(o)("common.sms-verify_code-placeholder"),"onUpdate:modelValue":t[0]||(t[0]=m=>g.value=m),class:"flex-1 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,ge),[[O,g.value]]),e("button",{type:"button",disabled:n.value>0||p.value||j.value,onClick:B,class:_(s(k)("h-8 px-3 rounded text-xs whitespace-nowrap transition",n.value>0||p.value||j.value?"bg-gray-600 text-white cursor-not-allowed":"bg-blue-600 text-white active:scale-95 cursor-pointer"))},r(p.value?s(o)("common.sms-verify_code-sending"):n.value>0?`${n.value}s`:s(o)("common.sms-verify_code-send-btn")),11,ye)])])]),e("button",{type:"submit",disabled:y.value,class:"w-full h-12 rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium"},r(y.value?s(o)("common.form.button.submitting"):s(o)("forgot-password.submit-btn1")),9,be)],32)):(f(),P("form",{key:1,onSubmit:I(U,["prevent"]),class:"space-y-3"},[e("div",he,[e("div",we,[e("label",_e,r(s(o)("register.password-label")),1),e("div",xe,[D(e("input",{type:d.value?"text":"password","onUpdate:modelValue":t[1]||(t[1]=m=>b.value=m),placeholder:s(o)("register.password-placeholder"),class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,ke),[[M,b.value]]),e("button",{type:"button",tabindex:"-1",onClick:t[2]||(t[2]=m=>d.value=!d.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[d.value?(f(),x(s(T),{key:0,size:18})):(f(),x(s(z),{key:1,size:18}))])])]),e("div",Se,[e("label",Ce,r(s(o)("register.confirm_password-label")),1),e("div",je,[D(e("input",{type:d.value?"text":"password","onUpdate:modelValue":t[3]||(t[3]=m=>h.value=m),placeholder:s(o)("register.confirm_password-placeholder"),class:"w-3/4 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,Ve),[[M,h.value]]),e("button",{type:"button",tabindex:"-1",onClick:t[4]||(t[4]=m=>d.value=!d.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[d.value?(f(),x(s(T),{key:0,size:18})):(f(),x(s(z),{key:1,size:18}))])])])]),e("button",{type:"submit",disabled:w.value,class:"w-full h-12 rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium"},r(w.value?s(o)("common.form.button.submitting"):s(o)("forgot-password.submit-btn2")),9,Ee),e("button",{type:"button",class:"w-full text-gray-500",onClick:t[5]||(t[5]=m=>u.value=1)},r(s(o)("forgot-password.submit-btn3")),1)],32)),u.value===1?(f(),x(c,{key:2,to:"/auth/login",class:"flex justify-center items-center mt-6 text-[rgb(0,0,238)]"},{default:G(()=>[F(r(s(o)("common.header.back")),1)]),_:1})):q("",!0)]),t[8]||(t[8]=e("div",{class:"h-14"},null,-1))])])}}});export{Be as default};
