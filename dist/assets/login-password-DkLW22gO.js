import{d as T,o as U,r as p,q as u,l as e,f as q,u as a,K as L,J as f,L as g,z as n,Q as w,S as b,k as v,U as P,F as k,t as S,R as j,x as D,B as I,v as i}from"./vue-vendor-ntQnFNWs.js";import{a as K,u as O,S as F,t as _}from"./index-BvHA6CJ8.js";import{e as R}from"./customer-Ca0wOw0D.js";import{g as $,h as A}from"./common-CgRnqZgV.js";import{E as C,a as V,S as B}from"./sodium-Db3Eh4S_.js";import{_ as H}from"./PageHeader.vue_vue_type_script_setup_true_lang-D4YorIBc.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-DHZYbvND.js";const Q={class:"flex min-h-screen justify-center bg-[#eef3f8]"},J={class:"w-full max-w-xl bg-[#f5f7fb] shadow-sm"},G={class:"bg-gray-100 flex justify-center"},W={class:"bg-white rounded-lg mb-3 overflow-hidden"},X={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},Y={class:"flex items-center px-4 py-3 border-b"},Z={class:"w-2/7 text-gray-700"},ee={class:"w-5/7 relative"},se=["type","placeholder"],te={key:0,class:"mt-1 px-4 text-xs text-red-500"},ae={class:"flex items-center px-4 py-3"},oe={class:"w-2/7 text-gray-700"},re={class:"w-5/7 relative"},le=["type","placeholder"],ne={key:1,class:"mt-1 px-4 text-xs text-red-500"},ie={class:"bg-white rounded-lg mb-3 overflow-hidden"},ue={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},de={class:"flex items-center px-4 py-3 border-b"},ce={class:"w-2/7 text-gray-700"},pe={value:""},me=["value"],fe={key:0,class:"mt-1 px-4 text-xs text-red-500"},we={class:"flex items-center px-4 py-3"},ve={class:"w-2/7 text-gray-700"},ye=["placeholder"],ge={key:1,class:"mt-1 px-4 text-xs text-red-500"},_e={class:"rounded-lg mb-3 overflow-hidden"},xe={class:"flex items-center text-gray-600 px-4 py-3 pb-0"},he={key:0,class:"px-4 py-3 space-y-2"},be=["innerHTML"],ke=["disabled"],qe=T({__name:"login-password",setup(Se){const E=I(),{t}=K(),M=O(),x=p(!0),h=p(""),c=p(!1),m=p(!1),y=p(""),o=p({safe_ask:"",answer:"",password:"",confirm_password:""}),l=p({}),z=()=>(l.value={},o.value.safe_ask?o.value.answer?o.value.answer.length>50?(l.value.answer=t("mine.security-settings.group-account.password.answer-max"),!1):!o.value.password||o.value.password.length<8?(l.value.password=t("mine.security-settings.group-account.password.login-password-min"),!1):o.value.password!==o.value.confirm_password?(l.value.confirm_password=t("mine.security-settings.group-account.password.confirm-password-eq"),!1):!0:(l.value.answer=t("common.form.placeholder.enter")+t("mine.toolcase.form-label.answer"),!1):(l.value.safe_ask=t("mine.toolcase.question-options.default"),!1)),N=async()=>{if(z()){m.value=!0;try{const d=await B.encrypt(o.value.password,y.value),s=await B.encrypt(o.value.confirm_password,y.value),r=await R({safe_ask:o.value.safe_ask,answer:o.value.answer,password:d,confirm_password:s});r.code===200?(_.success(r.message||"修改成功"),M.logout(),E.replace("/auth/login")):_.error(r.message||"修改失败")}catch{_.error("修改失败")}finally{m.value=!1}}};return U(async()=>{try{const d=await $("customer_reset_login_password_tips");h.value=d.data?.content||""}catch(d){console.error("加载提示内容失败",d)}finally{x.value=!1}A().then(({data:d,code:s})=>{s===200&&(y.value=d.key)})}),(d,s)=>(i(),u("div",Q,[e("div",J,[q(H,{title:a(t)("mine.setting.edit-password")},null,8,["title"]),e("div",G,[e("form",{onSubmit:L(N,["prevent"]),class:"w-full bg-gray-100 px-3 py-4"},[e("div",W,[e("div",X,[s[6]||(s[6]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),g(" "+n(a(t)("mine.security-settings.group-account.password.login-password")),1)]),e("div",Y,[e("label",Z,n(a(t)("mine.security-settings.group-account.password.login-password")),1),e("div",ee,[w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.password.login-password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,se),[[b,o.value.password]]),e("button",{type:"button",onClick:s[1]||(s[1]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),v(a(C),{key:0,size:18})):(i(),v(a(V),{key:1,size:18}))])])]),l.value.password?(i(),u("p",te,n(l.value.password),1)):f("",!0),e("div",ae,[e("label",oe,n(a(t)("mine.security-settings.group-account.password.confirm-password")),1),e("div",re,[w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.confirm_password=r),type:c.value?"text":"password",placeholder:a(t)("mine.security-settings.group-account.password.confirm-password-placeholder"),class:"text-gray-600 placeholder-gray-400 focus:outline-none h-10 w-full pr-10"},null,8,le),[[b,o.value.confirm_password]]),e("button",{type:"button",onClick:s[3]||(s[3]=r=>c.value=!c.value),class:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center text-gray-400 hover:text-gray-600"},[c.value?(i(),v(a(C),{key:0,size:18})):(i(),v(a(V),{key:1,size:18}))])])]),l.value.confirm_password?(i(),u("p",ne,n(l.value.confirm_password),1)):f("",!0)]),e("div",ie,[e("div",ue,[s[7]||(s[7]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),g(" "+n(a(t)("mine.security-settings.group-account.password.safe-ask-valid")),1)]),e("div",de,[e("label",ce,n(a(t)("mine.toolcase.form-label.question")),1),w(e("select",{"onUpdate:modelValue":s[4]||(s[4]=r=>o.value.safe_ask=r),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},[e("option",pe,n(a(t)("mine.toolcase.question-options.default")),1),(i(!0),u(k,null,S(a(F),r=>(i(),u("option",{key:r.value,value:r.value},n(a(t)(r.i18nKey)),9,me))),128))],512),[[P,o.value.safe_ask]])]),l.value.safe_ask?(i(),u("p",fe,n(l.value.safe_ask),1)):f("",!0),e("div",we,[e("label",ve,n(a(t)("mine.toolcase.form-label.answer")),1),w(e("input",{"onUpdate:modelValue":s[5]||(s[5]=r=>o.value.answer=r),type:"text",placeholder:a(t)("common.form.placeholder.enter")+a(t)("mine.toolcase.form-label.answer"),class:"text-gray-600 w-5/7 placeholder-gray-400 focus:outline-none h-10"},null,8,ye),[[j,o.value.answer]])]),l.value.answer?(i(),u("p",ge,n(l.value.answer),1)):f("",!0)]),e("div",_e,[e("div",xe,[s[8]||(s[8]=e("span",{class:"w-1 h-4 bg-red-600 rounded mr-2"},null,-1)),g(" "+n(a(t)("mine.security-settings.group-account.password.tip")),1)]),x.value?(i(),u("div",he,[(i(),u(k,null,S(3,r=>e("div",{key:r,class:"h-4 bg-gray-200 rounded animate-pulse"})),64))])):(i(),u("div",{key:1,class:"px-4 py-3 text-gray-600",innerHTML:h.value},null,8,be))]),e("button",{type:"submit",disabled:m.value,class:D(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",m.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},n(m.value?a(t)("common.form.button.submitting"):a(t)("common.form.button.submit")),11,ke)],32)]),s[9]||(s[9]=e("div",{class:"h-14"},null,-1))])]))}});export{qe as default};
