import{w as S,t as C}from"./customer-CDJyDjhM.js";import{t as v}from"./index-CIZoSaJ3.js";import{d as h}from"./dayjs.min-CLb2-34J.js";import{c as M}from"./index-C6jzfBHC.js";import{d as z,o as D,r as i,b as H,q as r,Q as L,C as w,F as b,t as R,x as a,l as o,n as d,y as g,u as Y}from"./vue-vendor-2ZNhN7Rr.js";import"./utils-vendor-CbLx3nH2.js";const B={class:"text-center"},V={class:"text-gray-900"},F={class:"text-center font-medium"},I={class:"text-center font-medium"},N={class:"text-center font-medium"},P={class:"text-center font-medium"},$={key:0},j={key:1},q=["onClick"],E={key:1,class:"py-4 text-center text-xs text-gray-400"},J=z({__name:"index",setup(O){const c=i([]),y=i(1),f=i(!0),x=i(!1),n=i(new Set),m=i(null);let _=null;const p=async s=>{x.value=!0;try{const{code:t,data:e,message:l}=await S({pagination:{page:s,size:20}});await new Promise(u=>setTimeout(u,600)),t===200?(e.length<20&&(f.value=!1),s===1&&(c.value=[]),c.value=[...c.value,...e]):v.error(l)}catch{v.error("获取数据失败")}finally{x.value=!1}},k=async s=>{if(!n.value.has(s)){n.value=new Set(n.value).add(s);try{const{code:t,data:e,message:l}=await C(s);t===200?(v.success(l),c.value=c.value.map(u=>u.id===s?e:u)):v.error(l)}catch{v.error("领取失败")}finally{const t=new Set(n.value);t.delete(s),n.value=t}}};return D(async()=>{await p(1),m.value&&f.value&&(_=new IntersectionObserver(([s])=>{if(s.isIntersecting&&!x.value){const t=y.value+1;y.value=t,p(t)}},{threshold:1}),_.observe(m.value))}),H(()=>{_&&_.disconnect()}),(s,t)=>(o(),r(b,null,[t[0]||(t[0]=L('<div class="grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-2 text-xs text-gray-500 border-b"><div class="text-center">日期</div><div class="text-center">有效流水</div><div class="text-center">充值</div><div class="text-center">返利</div><div class="text-center">状态</div></div>',1)),(o(!0),r(b,null,R(c.value,(e,l)=>(o(),r("div",{key:`all-key-${l}`,class:"grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-3 border-b text-sm items-center"},[d("div",B,[d("div",V,a(g(h).unix(e?.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),d("div",F,a((e?.wpoints||0).toLocaleString()),1),d("div",I,a(((e?.cz||0)*1e3).toLocaleString()),1),d("div",N,a((e?.hdpoints||0).toLocaleString()),1),d("div",P,[e.state===1?(o(),r("div",$,a(e.state_label)+"("+a(g(h).unix(e?.gettime||0).format("HH:mm"))+")",1)):e.state===2||e.state===3?(o(),r("div",j,a(e.state_label),1)):(o(),r("button",{key:2,class:Y(g(M)("px-2 py-1 text-xs rounded",n.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer")),onClick:u=>k(e.id||0)},a(n.value.has(e.id||0)?"领取中...":"领取"),11,q))])]))),128)),f.value?(o(),r("div",{key:0,ref_key:"loadMoreRef",ref:m,class:"py-4 text-center text-xs text-gray-400"},a(x.value?"加载中...":"上拉加载更多"),513)):w("",!0),f.value?w("",!0):(o(),r("div",E," 没有更多数据了 "))],64))}});export{J as default};
