import{d as B,o as H,r as f,b as J,q as n,f as M,u as l,F as h,l as s,J as p,c as X,Q as D,z as r,U as G,t as V,R as W,x as Z,K as ee,v as c,O as te,L as se}from"./vue-vendor-ntQnFNWs.js";import{_ as oe}from"./coin-BjeO1Yvx.js";import{a as ae,u as re,S as le,t as u}from"./index-C6XK1gma.js";import{A as ne}from"./customer-BXjt1XCl.js";import{_ as ce,b as ie}from"./ReceiveSms.vue_vue_type_script_setup_true_lang-DX-SlKGe.js";import{_ as de}from"./PageHeader.vue_vue_type_script_setup_true_lang-CEmtFThu.js";import{d as O}from"./dayjs.min-CLb2-34J.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-CXUrgsmq.js";const ue={class:"min-h-screen bg-[#f5f7fb] pb-16"},me={key:1,class:"px-3 pb-20 pt-3"},fe={class:"bg-white rounded-xl shadow-sm p-3"},ve={class:"flex items-center gap-2"},_e={class:"text-gray-700 w-16 flex-shrink-0"},xe={value:""},pe=["value"],ye={key:0,class:"mt-1 text-xs text-red-500"},ge={class:"bg-white rounded-xl shadow-sm p-3 mt-2"},he={class:"flex items-center gap-2"},be={class:"text-gray-700 w-16 flex-shrink-0"},we=["placeholder"],ke={key:0,class:"mt-1 text-xs text-red-500"},Se={key:1,class:"bg-white rounded-xl shadow-sm p-3"},Ce={class:"flex items-center gap-2"},Te={class:"text-gray-700 w-16 flex-shrink-0"},Ee={class:"flex-1 flex items-center gap-2 flex-nowrap"},Ie={key:0,class:"mt-1 text-xs text-red-500"},Ve=["disabled"],$e={key:2,class:"p-1"},Me={class:"flex justify-between items-center px-3 py-2"},De={class:"text-sm font-medium"},Oe=["disabled"],Re={class:"grid grid-cols-[0.5fr_0.5fr_1fr_0.7fr_0.4fr] py-2 text-xs text-gray-500 border-b bg-white px-1"},Ue={class:"text-center"},Ne={class:"text-center"},Ke={class:"text-center"},Le={class:"text-right"},Ye={key:1,class:"text-center py-8 text-gray-500 bg-white"},je={class:"font-medium text-xs"},Qe={class:"text-center font-medium text-xs"},qe={class:"text-center"},Ae={class:"text-red-500 flex items-center justify-center font-bold text-sm"},Fe={class:"text-xs text-gray-500"},Pe={class:"flex flex-col items-center justify-center text-xs text-gray-600"},ze={class:"flex flex-col items-end"},Be=["onClick"],He={key:1,class:"text-xs text-gray-400"},Je={key:4,class:"py-4 text-center text-xs text-gray-400"},C="toolcase_secure_token",T="toolcase_secure_token_expire",ct=B({__name:"index",setup(Xe){const{t:a}=ae(),R=re(),y=f(null),g=f(!1),b=X(()=>R.currentCustomer?.selectcardVerifyType||"safeQuestion"),i=f({safe_ask:"",answer:"",verify_code:""}),d=f({}),U=()=>{const e=localStorage.getItem(C),t=localStorage.getItem(T);if(!e||!t)return null;const o=parseInt(t,10);return Date.now()>o?(localStorage.removeItem(C),localStorage.removeItem(T),null):e},N=(e,t)=>{localStorage.setItem(C,e),localStorage.setItem(T,String(Date.now()+t*1e3))},K=()=>{localStorage.removeItem(C),localStorage.removeItem(T)},L=()=>{if(d.value={},b.value==="safeQuestion"){if(!i.value.safe_ask)return d.value.safe_ask=a("mine.toolcase.question-options.default"),!1;if(!i.value.answer)return d.value.answer=a("common.form.placeholder.enter")+a("mine.toolcase.form-label.answer"),!1;if(i.value.answer.length>50)return d.value.answer=a("mine.security-settings.group-account.password.answer-max"),!1}return b.value==="smsVerify"&&!i.value.verify_code?(d.value.verify_code=a("common.sms-verify_code-placeholder"),!1):!0},Y=async()=>{if(L()){g.value=!0;try{const e=await ne({safe_ask:i.value.safe_ask,answer:i.value.answer,verify_code:i.value.verify_code});e.code===200?(u.success(e.message||"验证成功"),y.value=!0,w.value=e.data.key,N(e.data.key,480),await S(1)):u.error(e.message||"验证失败")}catch{u.error("验证失败")}finally{g.value=!1}}},w=f(""),m=f([]),E=f(1),v=f(!0),_=f(!1),I=f(null);let k=null;const $=e=>{if(!e||e.length<=4)return e;const t=e.substring(0,2),o=e.substring(e.length-2);return`${t}****${o}`},j=e=>e?O.unix(e).format("YYYY-MM-DD"):"",Q=e=>e?O.unix(e).format("HH:mm"):"",S=async e=>{if(!_.value){_.value=!0;try{const t=await ie({search:{t:w.value},pagination:{page:e,size:20}});if(t.code===200){const o=t.data||[];o.length<20&&(v.value=!1),e===1?m.value=o:m.value=[...m.value,...o],E.value=e}else t.code===2002?(v.value=!1,u.error(t.message||"验证已过期，请重新验证"),A()):(v.value=!1,u.error(t.message||"获取数据失败"))}catch{v.value=!1,u.error("获取数据失败")}finally{_.value=!1}}},q=async()=>{v.value=!0,E.value=1,m.value=[],await S(1)},A=()=>{K(),y.value=!1,w.value="",m.value=[]},F=async(e,t)=>{const o=`${e} ${t}`;try{await navigator.clipboard.writeText(o),u.success(a("mine.toolcase.record-copied"))}catch{const x=document.createElement("textarea");x.value=o,x.style.position="fixed",x.style.opacity="0",document.body.appendChild(x),x.select(),document.execCommand("copy"),document.body.removeChild(x),u.success(a("mine.toolcase.record-copied"))}},P=async()=>{const e=m.value.filter(t=>t.state===0).map(t=>`${t.no} ${t.pwd}`).join(`
`);if(!e){u.warning("没有可复制的卡密");return}try{await navigator.clipboard.writeText(e),u.success(a("mine.toolcase.record-copied"))}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),u.success(a("mine.toolcase.record-copied"))}},z=()=>{!I.value||!v.value||(k=new IntersectionObserver(([e])=>{e.isIntersecting&&!_.value&&v.value&&S(E.value+1)},{threshold:1}),k.observe(I.value))};return H(async()=>{const e=U();e?(y.value=!0,w.value=e,await S(1),setTimeout(z,100)):y.value=!1}),J(()=>{k&&k.disconnect()}),(e,t)=>(c(),n("div",ue,[M(de,{title:l(a)("mine.setting.toolcase")},null,8,["title"]),y.value===null?(c(),n(h,{key:0},[],64)):y.value?(c(),n("div",$e,[s("div",Me,[s("span",De,r(l(a)("mine.toolcase.record-title")),1),s("button",{onClick:P,class:"text-xs text-blue-600"},r(l(a)("mine.toolcase.record-copy-all")),1),s("button",{onClick:q,disabled:_.value,class:"text-xs text-blue-600"},r(_.value?l(a)("mine.toolcase.record-refresh-pending"):l(a)("mine.toolcase.record-refresh")),9,Oe)]),s("div",Re,[s("div",null,r(l(a)("mine.toolcase.record-grid-1")),1),s("div",Ue,r(l(a)("mine.toolcase.record-grid-2")),1),s("div",Ne,r(l(a)("mine.toolcase.record-grid-3")),1),s("div",Ke,r(l(a)("mine.toolcase.record-grid-4")),1),s("div",Le,r(l(a)("mine.toolcase.record-grid-5")),1)]),_.value&&m.value.length===0?(c(),n(h,{key:0},V(5,o=>s("div",{key:o,class:"grid grid-cols-[0.5fr_0.5fr_1fr_0.7fr_0.4fr] py-2 border-b px-1 bg-white"},[...t[3]||(t[3]=[te('<div class="h-4 bg-gray-200 rounded animate-pulse"></div><div class="h-4 bg-gray-200 rounded animate-pulse mx-1"></div><div class="h-4 bg-gray-200 rounded animate-pulse mx-1"></div><div class="h-4 bg-gray-200 rounded animate-pulse mx-1"></div><div class="h-4 bg-gray-200 rounded animate-pulse"></div>',5)])])),64)):!_.value&&m.value.length===0?(c(),n("div",Ye," 暂无卡密记录 ")):(c(!0),n(h,{key:2},V(m.value,(o,x)=>(c(),n("div",{key:`card-${x}`,class:"grid grid-cols-[0.5fr_0.5fr_1fr_0.7fr_0.4fr] py-2 border-b items-center px-1 text-sm bg-white"},[s("div",je,r($(o?.no||"")),1),s("div",Qe,r($(o?.pwd||"")),1),s("div",qe,[s("div",Ae,[se(r((o?.points||0).toLocaleString())+" ",1),t[4]||(t[4]=s("img",{src:oe,alt:"coin",class:"inline-block w-[13px] h-[13px] ml-0.5"},null,-1))]),s("div",Fe," ¥"+r(((o?.points||0)/1e3).toFixed(2)),1)]),s("div",Pe,[s("div",null,r(j(o?.addtime)),1),s("div",null,r(Q(o?.addtime)),1)]),s("div",ze,[o.state===0?(c(),n("button",{key:0,onClick:Ge=>F(o.no||"",o.pwd||""),class:"px-1 py-0.5 bg-red-600 text-white text-xs rounded cursor-pointer"},r(l(a)("mine.toolcase.record-copy-one")),9,Be)):(c(),n("span",He,r(o.state_label),1))])]))),128)),v.value?(c(),n("div",{key:3,ref_key:"loadMoreRef",ref:I,class:"py-4 text-center text-xs text-gray-400"},r(_.value?l(a)("common.loading"):l(a)("common.loading-hit")),513)):p("",!0),!v.value&&m.value.length>0?(c(),n("div",Je,r(l(a)("common.loading-list-empty")),1)):p("",!0)])):(c(),n("main",me,[s("form",{onSubmit:ee(Y,["prevent"]),class:"mt-5"},[b.value==="safeQuestion"?(c(),n(h,{key:0},[s("div",fe,[s("div",ve,[s("label",_e,r(l(a)("mine.toolcase.form-label.question")),1),D(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value.safe_ask=o),class:"flex-1 text-gray-800 placeholder-gray-400 focus:outline-none h-12 bg-transparent"},[s("option",xe,r(l(a)("mine.toolcase.question-options.default")),1),(c(!0),n(h,null,V(l(le),o=>(c(),n("option",{key:o.value,value:o.value},r(l(a)(o.i18nKey)),9,pe))),128))],512),[[G,i.value.safe_ask]])]),d.value.safe_ask?(c(),n("p",ye,r(d.value.safe_ask),1)):p("",!0)]),s("div",ge,[s("div",he,[s("label",be,r(l(a)("mine.toolcase.form-label.answer")),1),D(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>i.value.answer=o),type:"text",placeholder:l(a)("common.form.placeholder.enter")+l(a)("mine.toolcase.form-label.answer"),class:"flex-1 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,we),[[W,i.value.answer]])]),d.value.answer?(c(),n("p",ke,r(d.value.answer),1)):p("",!0)])],64)):p("",!0),b.value==="smsVerify"?(c(),n("div",Se,[s("div",Ce,[s("label",Te,r(l(a)("common.sms-verify_code-label")),1),s("div",Ee,[M(ce,{modelValue:i.value.verify_code,"onUpdate:modelValue":t[2]||(t[2]=o=>i.value.verify_code=o),scene:"view_card_password",disabled:g.value},null,8,["modelValue","disabled"])])]),d.value.verify_code?(c(),n("p",Ie,r(d.value.verify_code),1)):p("",!0)])):p("",!0),s("button",{type:"submit",disabled:g.value,class:Z(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",g.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},r(g.value?l(a)("common.form.button.submitting"):l(a)("common.form.button.submit")),11,Ve)],32)]))]))}});export{ct as default};
