import{d as z,o as A,r as u,b as B,q as l,f as H,u as n,F as w,l as s,J as k,Q as $,z as r,U as Q,t as I,R as J,x as X,K as G,v as c,O as W,L as Z}from"./vue-vendor-ntQnFNWs.js";import{_ as ee}from"./coin-BjeO1Yvx.js";import{a as te,S as se,t as i}from"./index-FdFg60UN.js";import{A as oe}from"./customer-D_FikQ7t.js";import{b as ae}from"./shop-3T4tclci.js";import{_ as re}from"./PageHeader.vue_vue_type_script_setup_true_lang-BXIr5qQq.js";import{d as D}from"./dayjs.min-CLb2-34J.js";import"./utils-vendor-CbLx3nH2.js";import"./index-C6jzfBHC.js";import"./chevron-left-Dp8QZFdo.js";const ne={class:"min-h-screen bg-[#f5f7fb] pb-16"},le={key:1,class:"px-3 pb-20 pt-3"},ce={class:"bg-white rounded-xl shadow-sm p-3"},ie={class:"flex items-center gap-2"},de={class:"text-gray-700 w-16 flex-shrink-0"},ue={value:""},me=["value"],fe={key:0,class:"mt-1 text-xs text-red-500"},ve={class:"bg-white rounded-xl shadow-sm p-3 mt-2"},_e={class:"flex items-center gap-2"},xe={class:"text-gray-700 w-16 flex-shrink-0"},pe=["placeholder"],ge={key:0,class:"mt-1 text-xs text-red-500"},he=["disabled"],ye={key:2,class:"p-1"},be={class:"flex justify-between items-center px-3 py-2"},we={class:"text-sm font-medium"},ke=["disabled"],Se={class:"grid grid-cols-[0.5fr_0.5fr_1fr_0.7fr_0.4fr] py-2 text-xs text-gray-500 border-b bg-white px-1"},Ce={class:"text-center"},Te={class:"text-center"},Ee={class:"text-center"},Ie={class:"text-right"},Me={key:1,class:"text-center py-8 text-gray-500 bg-white"},$e={class:"font-medium text-xs"},De={class:"text-center font-medium text-xs"},Oe={class:"text-center"},Re={class:"text-red-500 flex items-center justify-center font-bold text-sm"},Ne={class:"text-xs text-gray-500"},Ue={class:"flex flex-col items-center justify-center text-xs text-gray-600"},Ve={class:"flex flex-col items-end"},Ke=["onClick"],Le={key:1,class:"text-xs text-gray-400"},Ye={key:4,class:"py-4 text-center text-xs text-gray-400"},S="toolcase_secure_token",C="toolcase_secure_token_expire",We=z({__name:"index",setup(je){const{t:a}=te(),p=u(null),g=u(!1),m=u({safe_ask:"",answer:""}),_=u({}),O=()=>{const e=localStorage.getItem(S),t=localStorage.getItem(C);if(!e||!t)return null;const o=parseInt(t,10);return Date.now()>o?(localStorage.removeItem(S),localStorage.removeItem(C),null):e},R=(e,t)=>{localStorage.setItem(S,e),localStorage.setItem(C,String(Date.now()+t*1e3))},N=()=>{localStorage.removeItem(S),localStorage.removeItem(C)},U=()=>(_.value={},m.value.safe_ask?m.value.answer?m.value.answer.length>50?(_.value.answer=a("mine.security-settings.group-account.password.answer-max"),!1):!0:(_.value.answer=a("common.form.placeholder.enter")+a("mine.toolcase.form-label.answer"),!1):(_.value.safe_ask=a("mine.toolcase.question-options.default"),!1)),V=async()=>{if(U()){g.value=!0;try{const e=await oe({safe_ask:m.value.safe_ask,answer:m.value.answer});e.code===200?(i.success(e.message||"验证成功"),p.value=!0,h.value=e.data.key,R(e.data.key,480),await b(1)):i.error(e.message||"验证失败")}catch{i.error("验证失败")}finally{g.value=!1}}},h=u(""),d=u([]),T=u(1),f=u(!0),v=u(!1),E=u(null);let y=null;const M=e=>{if(!e||e.length<=4)return e;const t=e.substring(0,2),o=e.substring(e.length-2);return`${t}****${o}`},K=e=>e?D.unix(e).format("YYYY-MM-DD"):"",L=e=>e?D.unix(e).format("HH:mm"):"",b=async e=>{if(!v.value){v.value=!0;try{const t=await ae({search:{t:h.value},pagination:{page:e,size:20}});if(t.code===200){const o=t.data||[];o.length<20&&(f.value=!1),e===1?d.value=o:d.value=[...d.value,...o],T.value=e}else t.code===2002?(f.value=!1,i.error(t.message||"验证已过期，请重新验证"),j()):(f.value=!1,i.error(t.message||"获取数据失败"))}catch{f.value=!1,i.error("获取数据失败")}finally{v.value=!1}}},Y=async()=>{f.value=!0,T.value=1,d.value=[],await b(1)},j=()=>{N(),p.value=!1,h.value="",d.value=[]},q=async(e,t)=>{const o=`${e} ${t}`;try{await navigator.clipboard.writeText(o),i.success(a("mine.toolcase.record-copied"))}catch{const x=document.createElement("textarea");x.value=o,x.style.position="fixed",x.style.opacity="0",document.body.appendChild(x),x.select(),document.execCommand("copy"),document.body.removeChild(x),i.success(a("mine.toolcase.record-copied"))}},F=async()=>{const e=d.value.filter(t=>t.state===0).map(t=>`${t.no} ${t.pwd}`).join(`
`);if(!e){i.warning("没有可复制的卡密");return}try{await navigator.clipboard.writeText(e),i.success(a("mine.toolcase.record-copied"))}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),i.success(a("mine.toolcase.record-copied"))}},P=()=>{!E.value||!f.value||(y=new IntersectionObserver(([e])=>{e.isIntersecting&&!v.value&&f.value&&b(T.value+1)},{threshold:1}),y.observe(E.value))};return A(async()=>{const e=O();e?(p.value=!0,h.value=e,await b(1),setTimeout(P,100)):p.value=!1}),B(()=>{y&&y.disconnect()}),(e,t)=>(c(),l("div",ne,[H(re,{title:n(a)("mine.setting.toolcase")},null,8,["title"]),p.value===null?(c(),l(w,{key:0},[],64)):p.value?(c(),l("div",ye,[s("div",be,[s("span",we,r(n(a)("mine.toolcase.record-title")),1),s("button",{onClick:F,class:"text-xs text-blue-600"},r(n(a)("mine.toolcase.record-copy-all")),1),s("button",{onClick:Y,disabled:v.value,class:"text-xs text-blue-600"},r(v.value?n(a)("mine.toolcase.record-refresh-pending"):n(a)("mine.toolcase.record-refresh")),9,ke)]),s("div",Se,[s("div",null,r(n(a)("mine.toolcase.record-grid-1")),1),s("div",Ce,r(n(a)("mine.toolcase.record-grid-2")),1),s("div",Te,r(n(a)("mine.toolcase.record-grid-3")),1),s("div",Ee,r(n(a)("mine.toolcase.record-grid-4")),1),s("div",Ie,r(n(a)("mine.toolcase.record-grid-5")),1)]),v.value&&d.value.length===0?(c(),l(w,{key:0},I(5,o=>s("div",{key:o,class:"grid grid-cols-[0.5fr_0.5fr_1fr_0.7fr_0.4fr] py-2 border-b px-1 bg-white"},[...t[2]||(t[2]=[W('<div class="h-4 bg-gray-200 rounded animate-pulse"></div><div class="h-4 bg-gray-200 rounded animate-pulse mx-1"></div><div class="h-4 bg-gray-200 rounded animate-pulse mx-1"></div><div class="h-4 bg-gray-200 rounded animate-pulse mx-1"></div><div class="h-4 bg-gray-200 rounded animate-pulse"></div>',5)])])),64)):!v.value&&d.value.length===0?(c(),l("div",Me," 暂无卡密记录 ")):(c(!0),l(w,{key:2},I(d.value,(o,x)=>(c(),l("div",{key:`card-${x}`,class:"grid grid-cols-[0.5fr_0.5fr_1fr_0.7fr_0.4fr] py-2 border-b items-center px-1 text-sm bg-white"},[s("div",$e,r(M(o?.no||"")),1),s("div",De,r(M(o?.pwd||"")),1),s("div",Oe,[s("div",Re,[Z(r((o?.points||0).toLocaleString())+" ",1),t[3]||(t[3]=s("img",{src:ee,alt:"coin",class:"inline-block w-[13px] h-[13px] ml-0.5"},null,-1))]),s("div",Ne," ¥"+r(((o?.points||0)/1e3).toFixed(2)),1)]),s("div",Ue,[s("div",null,r(K(o?.addtime)),1),s("div",null,r(L(o?.addtime)),1)]),s("div",Ve,[o.state===0?(c(),l("button",{key:0,onClick:qe=>q(o.no||"",o.pwd||""),class:"px-1 py-0.5 bg-red-600 text-white text-xs rounded cursor-pointer"},r(n(a)("mine.toolcase.record-copy-one")),9,Ke)):(c(),l("span",Le,r(o.state_label),1))])]))),128)),f.value?(c(),l("div",{key:3,ref_key:"loadMoreRef",ref:E,class:"py-4 text-center text-xs text-gray-400"},r(v.value?n(a)("common.loading"):n(a)("common.loading-hit")),513)):k("",!0),!f.value&&d.value.length>0?(c(),l("div",Ye,r(n(a)("common.loading-list-empty")),1)):k("",!0)])):(c(),l("main",le,[s("form",{onSubmit:G(V,["prevent"]),class:"mt-5"},[s("div",ce,[s("div",ie,[s("label",de,r(n(a)("mine.toolcase.form-label.question")),1),$(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>m.value.safe_ask=o),class:"flex-1 text-gray-800 placeholder-gray-400 focus:outline-none h-12 bg-transparent"},[s("option",ue,r(n(a)("mine.toolcase.question-options.default")),1),(c(!0),l(w,null,I(n(se),o=>(c(),l("option",{key:o.value,value:o.value},r(n(a)(o.i18nKey)),9,me))),128))],512),[[Q,m.value.safe_ask]])]),_.value.safe_ask?(c(),l("p",fe,r(_.value.safe_ask),1)):k("",!0)]),s("div",ve,[s("div",_e,[s("label",xe,r(n(a)("mine.toolcase.form-label.answer")),1),$(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>m.value.answer=o),type:"text",placeholder:n(a)("common.form.placeholder.enter")+n(a)("mine.toolcase.form-label.answer"),class:"flex-1 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,8,pe),[[J,m.value.answer]])]),_.value.answer?(c(),l("p",ge,r(_.value.answer),1)):k("",!0)]),s("button",{type:"submit",disabled:g.value,class:X(["mt-10 h-12 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium tracking-wide transition transform active:scale-95",g.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},r(g.value?n(a)("common.form.button.submitting"):n(a)("common.form.button.submit")),11,he)],32)]))]))}});export{We as default};
