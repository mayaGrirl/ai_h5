import{q as S,x as M}from"./customer-D_FikQ7t.js";import{t as v}from"./index-FdFg60UN.js";import{d as h}from"./dayjs.min-CLb2-34J.js";import{c as C}from"./index-C6jzfBHC.js";import{d as z,o as D,r as i,b as H,q as r,O as L,J as b,F as k,t as R,z as a,v as o,l as d,u as g,x as Y}from"./vue-vendor-ntQnFNWs.js";import"./utils-vendor-CbLx3nH2.js";const B={class:"text-center"},V={class:"text-gray-900"},q={class:"text-center font-medium"},F={class:"text-center font-medium"},I={class:"text-center font-medium"},N={class:"text-center font-medium"},O={key:0},P={key:1},$=["onClick"],j={key:1,class:"py-4 text-center text-xs text-gray-400"},K=z({__name:"index",setup(E){const c=i([]),p=i(1),f=i(!0),x=i(!1),n=i(new Set),m=i(null);let _=null;const y=async s=>{x.value=!0;try{const{code:t,data:e,message:l}=await S({pagination:{page:s,size:20}});await new Promise(u=>setTimeout(u,600)),t===200?(e.length<20&&(f.value=!1),s===1&&(c.value=[]),c.value=[...c.value,...e]):v.error(l)}catch{v.error("获取数据失败")}finally{x.value=!1}},w=async s=>{if(!n.value.has(s)){n.value=new Set(n.value).add(s);try{const{code:t,data:e,message:l}=await M(s);t===200?(v.success(l),c.value=c.value.map(u=>u.id===s?e:u)):v.error(l)}catch{v.error("领取失败")}finally{const t=new Set(n.value);t.delete(s),n.value=t}}};return D(async()=>{await y(1),m.value&&f.value&&(_=new IntersectionObserver(([s])=>{if(s.isIntersecting&&!x.value){const t=p.value+1;p.value=t,y(t)}},{threshold:1}),_.observe(m.value))}),H(()=>{_&&_.disconnect()}),(s,t)=>(o(),r(k,null,[t[0]||(t[0]=L('<div class="grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-2 text-xs text-gray-500 border-b"><div class="text-center">日期</div><div class="text-center">亏损</div><div class="text-center">充值</div><div class="text-center">返利</div><div class="text-center">状态</div></div>',1)),(o(!0),r(k,null,R(c.value,(e,l)=>(o(),r("div",{key:`all-key-${l}`,class:"grid grid-cols-[1.2fr_0.8fr_0.8fr_1fr_1fr] px-3 py-3 border-b text-sm items-center"},[d("div",B,[d("div",V,a(g(h).unix(e?.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),d("div",q,a((e?.points||0).toLocaleString()),1),d("div",F,a(((e?.cz||0)*1e3).toLocaleString()),1),d("div",I,a((e?.hdpoints||0).toLocaleString()),1),d("div",N,[e.state===1?(o(),r("div",O,a(e.state_label)+"("+a(g(h).unix(e?.gettime||0).format("HH:mm"))+")",1)):e.state===2||e.state===3?(o(),r("div",P,a(e.state_label),1)):(o(),r("button",{key:2,class:Y(g(C)("px-2 py-1 text-xs rounded",n.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer")),onClick:u=>w(e.id||0)},a(n.value.has(e.id||0)?"领取中...":"领取"),11,$))])]))),128)),f.value?(o(),r("div",{key:0,ref_key:"loadMoreRef",ref:m,class:"py-4 text-center text-xs text-gray-400"},a(x.value?"加载中...":"上拉加载更多"),513)):b("",!0),f.value?b("",!0):(o(),r("div",j," 没有更多数据了 "))],64))}});export{K as default};
