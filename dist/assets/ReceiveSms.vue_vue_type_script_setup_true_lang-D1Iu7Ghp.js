import{h as f,a as _,t as i}from"./index-CIZoSaJ3.js";import{B as k}from"./customer-CDJyDjhM.js";import{d as V,w as B,b as S,q as l,F as r,n as v,y as d,u as T,r as h,N as m,x as p,l as u}from"./vue-vendor-2ZNhN7Rr.js";const F=a=>f.post("/api/app/v1/card/records",a),U=()=>f.get("/api/app/v1/card/detail",{}),q=a=>f.post("/api/app/v1/card/exchange",a),I=["value","placeholder"],N=["disabled"],R=60,z=V({__name:"ReceiveSms",props:{modelValue:{default:""},scene:{},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{emit:y}){const g=a,x=y,{t:o}=_(),t=h(0),n=h(!1);let s=null;B(t,e=>{if(e<=0){s&&(clearTimeout(s),s=null);return}s=setTimeout(()=>{t.value--},1e3)}),S(()=>{s&&(clearTimeout(s),s=null)});const b=async()=>{if(!(n.value||t.value>0)){n.value=!0;try{const{code:e,message:c}=await k(g.scene);e!==200?i.error(c||o("common.sms-verify_code-send-failed")):(i.success(o("common.send-success")),t.value=R)}catch(e){const c=e instanceof Error?e.message:o("common.sms-verify_code-send-failed");i.error(c)}finally{n.value=!1}}},w=e=>{x("update:modelValue",e.target.value)};return(e,c)=>(u(),l(r,null,[v("input",{value:a.modelValue,onInput:w,type:"text",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",placeholder:d(o)("common.sms-verify_code-placeholder"),class:"flex-1 min-w-0 text-gray-800 placeholder-gray-400 focus:outline-none h-12"},null,40,I),v("button",{type:"button",disabled:a.disabled||n.value||t.value>0,onClick:b,class:T(["shrink-0 h-8 px-3 rounded text-xs whitespace-nowrap transition",a.disabled||n.value||t.value>0?"bg-gray-600 text-white cursor-not-allowed":"bg-blue-600 text-white active:scale-95 cursor-pointer"])},[n.value?(u(),l(r,{key:0},[m(p(d(o)("common.sms-verify_code-sending")),1)],64)):t.value>0?(u(),l(r,{key:1},[m(p(t.value)+"s ",1)],64)):(u(),l(r,{key:2},[m(p(d(o)("common.sms-verify_code-send-btn")),1)],64))],10,N)],64))}});export{z as _,U as a,F as b,q as c};
